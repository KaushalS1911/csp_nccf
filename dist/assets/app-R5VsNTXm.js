import{r as i,u as O,K as S,f as oe,j as e,bs as re,cP as F,bt as ne,F as ae,bu as le,N as ce,g as ie,bv as de,D as v,M as A,cn as ue,aF as H,a as he,c as me,cQ as pe,cR as ge,aJ as xe,C as L,cu as be,R as fe,i as D,q as k,cS as ye,cT as je,cU as Ce,cV as we,bQ as Se,cW as Te,c9 as Re,h as Pe,bR as ve,bS as Oe,bT as ke,bU as _e,cX as Fe,cY as Ae,cZ as Be,c_ as Ee,c$ as De,d0 as We,d1 as He,a8 as p,ah as w,d2 as P,a2 as I,d3 as T,B as G,T as B,S as Le,ai as Ie,d4 as N,d5 as J,bK as Q,ay as Ne,br as ze,d6 as Ue,bd as qe,bw as Me,cd as $e,d7 as q,d8 as M,H as Ve,d9 as Ge}from"./index-QK5BOp0B.js";function Je({editDialogOpen:o,setEditDialogOpen:h,editData:n,dataFiltered:a,fetchAllOrdersDemo:b}){const[g,t]=i.useState([]),{vendor:x}=O();i.useState({}),i.useEffect(()=>{r()},[]);function r(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(C=>{var s;t((s=C.data)==null?void 0:s.data)})}const d=oe({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:c,handleSubmit:f,formState:{isSubmitting:y}}=d;i.useEffect(()=>{n&&c({csp_code:n==null?void 0:n.csp_code,commodity:n==null?void 0:n.commodity,quantity:n==null?void 0:n.quantity})},[n]);const l=async C=>{h(!1);const s={...C,csp_code:x.csp_code,mode:"test",status:"0"};try{const m=await S.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",s);m.data.status=="201"?(A("Order added successfully!"),b()):m.data.status=="400"&&A("Failed to add order.",{variant:"error"})}catch(m){console.error("Order creation error:",m),A("Order creation failed.",{variant:"error"})}};return e.jsx(re,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>h(!1),children:e.jsxs(F,{sx:{py:5,px:3},children:[e.jsx(ne,{children:"Edit Order"}),e.jsxs(ae,{methods:d,children:[e.jsxs(le,{maxWidth:"lg ",children:[e.jsx(F,{mb:2,mt:1,children:e.jsx(ce,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:g.map(C=>C==null?void 0:C.commodity_name),getOptionLabel:C=>C})}),e.jsx(F,{mt:2,children:e.jsx(ie,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(de,{children:[e.jsx(v,{onClick:()=>h(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(v,{variant:"contained",onClick:f(l),children:"Save"})]})]})]})})}const Qe=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],E={name:"",commodity:[],order_status:[],status:"all"};function Ke({tableData:o,fetchAllOrdersDemo:h}){const{enqueueSnackbar:n}=ue(),a=H(),b=he(),g=me(),t=pe(),[x,r]=i.useState(!1),[d,c]=i.useState(0),[f,y]=i.useState(E),[l,C]=i.useState({}),s=Ye({inputData:o,comparator:ge(t.order,t.orderBy),filters:f}),m=s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),z=t.dense?56:76,U=!xe(E,f),X=!s.length&&U||!s.length,R=i.useCallback((u,j)=>{t.onResetPage(),y(_=>({..._,[u]:j}))},[t]),Z=i.useCallback(()=>{y(E)},[]),ee=i.useCallback(u=>{const j=o.filter(_=>_.id!==u);n("Delete success!"),setTableData(j),t.onUpdatePageDeleteRow(m.length)},[m.length,n,t,o]),te=i.useCallback(()=>{const u=o.filter(j=>!t.selected.includes(j.id));n("Delete success!"),setTableData(u),t.onUpdatePageDeleteRows({totalRowsInPage:m.length,totalRowsFiltered:s.length})},[s.length,m.length,n,t,o]),se=i.useCallback(u=>{c(u==null?void 0:u.id),C(u)},[b]);return i.useCallback((u,j)=>{R("status",j)},[R]),i.useCallback(u=>{setTableData(j=>[...j,u])},[n]),e.jsxs(e.Fragment,{children:[e.jsxs(L,{maxWidth:a.themeStretch?!1:"xxl",children:[e.jsx(be,{heading:"Orders",links:[{name:""}],action:e.jsx(v,{component:fe,variant:"contained",startIcon:e.jsx(D,{icon:"mingcute:add-line"}),onClick:()=>{r(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(k,{children:[e.jsx(ye,{filters:f,onFilters:R,commodityOptions:je,orderStatusOptions:Ce}),U&&e.jsx(we,{filters:f,onFilters:R,onResetFilters:Z,results:s.length,sx:{p:2.5,pt:0}}),e.jsxs(Se,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Te,{dense:!0,numSelected:t.selected.length,rowCount:s.length,onSelectAllRows:u=>t.onSelectAllRows(u,s.map(j=>j.id)),action:e.jsx(Re,{title:"Delete",children:e.jsx(Pe,{color:"primary",onClick:g.onTrue,children:e.jsx(D,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ve,{children:e.jsxs(Oe,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ke,{order:t.order,orderBy:t.orderBy,headLabel:Qe,rowCount:s.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:u=>t.onSelectAllRows(u,s.map(j=>j.id))}),e.jsxs(_e,{children:[s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((u,j)=>e.jsx(Fe,{row:{...u,index:j},selected:t.selected.includes(u.id),onSelectRow:()=>t.onSelectRow(u.id),onDeleteRow:()=>ee(u.id),onEditRow:()=>se(u)},u.id)),e.jsx(Ae,{height:z,emptyRows:Be(t.page,t.rowsPerPage,o.length)}),e.jsx(Ee,{isNotFound:X})]})]})}),e.jsx(De,{count:s.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(We,{open:g.value,onClose:g.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(v,{variant:"contained",color:"error",onClick:()=>{te(),g.onFalse()},children:"Delete"})}),e.jsx(He,{dialogOpen:x,setDialogOpen:r,editId:l,fetchAllOrdersDemo:h}),e.jsx(Je,{editDialogOpen:d,setEditDialogOpen:c,editData:l,dataFiltered:s,fetchAllOrdersDemo:h})]})}function Ye({inputData:o,comparator:h,filters:n}){const{name:a,status:b,commodity:g,order_status:t}=n,x=o.map((r,d)=>[r,d]);return x.sort((r,d)=>{const c=h(r[0],d[0]);return c!==0?c:r[1]-d[1]}),o=x.map(r=>r[0]),a&&(o=o.filter(r=>r.commodity.toLowerCase().includes(a.toLowerCase()))),b!=="all"&&(o=o.filter(r=>r.status===b)),g.length&&(o=o.filter(r=>g.includes(r.commodity))),t.length&&(o=o.filter(r=>t.includes(r.nccf_order_status))),o}p.string,p.array,p.array,p.string;p.object;function Xe({vendorCode:o}){const{vendor:h}=O(),n=H(),[a,b]=i.useState({}),[g,t]=i.useState([]),[x,r]=i.useState(0);i.useEffect(()=>{h.csp_code&&(f(),c())},[x]);function d(){r(y=>y+1)}function c(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders_stats`).then(y=>{var l;b((l=y.data)==null?void 0:l.data[0])})}function f(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders`).then(y=>{var l;t((l=y.data)==null?void 0:l.data)})}return e.jsx(L,{maxWidth:n.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Total Orders",total:(a==null?void 0:a.total_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Pending",total:(a==null?void 0:a.placed_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Accepted",total:(a==null?void 0:a.accepted_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Declined",total:(a==null?void 0:a.declined_orders)||"0"})}),e.jsx(w,{xs:12,lg:12,children:e.jsx(Ke,{tableData:g,fetchAllOrdersDemo:d})})]})})}function W({title:o,percent:h,total:n,chart:a,sx:b,...g}){const t=I(),{colors:x=[t.palette.primary.light,t.palette.primary.main],series:r,options:d}=a,c={colors:x.map(f=>f[1]),fill:{type:"gradient",gradient:{colorStops:[{offset:0,color:x[0],opacity:1},{offset:100,color:x[1],opacity:1}]}},chart:{sparkline:{enabled:!0}},plotOptions:{bar:{columnWidth:"68%",borderRadius:2}},tooltip:{x:{show:!1},y:{formatter:f=>T(f),title:{formatter:()=>""}},marker:{show:!1}},...d};return e.jsxs(k,{sx:{display:"flex",alignItems:"center",p:3,...b},...g,children:[e.jsxs(G,{sx:{flexGrow:1},children:[e.jsx(B,{variant:"subtitle2",children:o}),e.jsx(Le,{direction:"row",alignItems:"center",sx:{mt:2,mb:1},children:e.jsxs(B,{component:"div",variant:"subtitle2",children:[h>0&&"+",Ie(h)]})}),e.jsx(B,{variant:"h3",children:T(n)})]}),e.jsx(N,{dir:"ltr",type:"bar",series:[{data:r}],options:c,width:60,height:36})]})}W.propTypes={chart:p.object,percent:p.number,sx:p.object,title:p.string,total:p.number};const $=400,V=72,Ze=Ne(N)(({theme:o})=>({height:$,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:V,borderTop:`dashed 1px ${o.palette.divider}`,top:`calc(${$-V}px) !important`}}));function K({title:o,subheader:h,chart:n,...a}){const b=I(),{colors:g,series:t,options:x}=n,r=t.map(c=>c.value),d=J({chart:{sparkline:{enabled:!0}},colors:g,labels:t.map(c=>c.label),stroke:{colors:[b.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:c=>T(c),title:{formatter:c=>`${c}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:c=>T(c)},total:{formatter:c=>{const f=c.globals.seriesTotals.reduce((y,l)=>y+l,0);return T(f)}}}}}},...x});return e.jsxs(k,{...a,children:[e.jsx(Q,{title:o,subheader:h,sx:{mb:5}}),e.jsx(Ze,{dir:"ltr",type:"donut",series:r,options:d,width:"100%",height:280})]})}K.propTypes={chart:p.object,subheader:p.string,title:p.string};function Y({title:o,subheader:h,chart:n,...a}){const{labels:b,colors:g,series:t,options:x}=n,r=ze(),[d,c]=i.useState("Week"),f=J({chart:{stacked:!0},colors:g,stroke:{width:0},xaxis:{categories:d==="Week"&&b.week||d==="Month"&&b.month||b.year},tooltip:{y:{formatter:l=>Ue(l)}},plotOptions:{bar:{borderRadius:d==="Week"&&8||d==="Month"&&6||10,columnWidth:"20%"}},...x}),y=i.useCallback(l=>{r.onClose(),c(l)},[r]);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{...a,children:[e.jsx(Q,{title:o,subheader:h,action:e.jsxs(qe,{onClick:r.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[d,e.jsx(D,{width:16,icon:r.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),t.map(l=>e.jsx(G,{sx:{mt:3,mx:3},children:l.type===d&&e.jsx(N,{dir:"ltr",type:"bar",series:l.data,options:f,width:"100%",height:375})},l.type))]}),e.jsx(Me,{open:r.open,onClose:r.onClose,sx:{width:140},children:t.map(l=>e.jsx($e,{selected:l.type===d,onClick:()=>y(l.type),children:l.type},l.type))})]})}Y.propTypes={chart:p.object,subheader:p.string,title:p.string};p.bool,p.string,p.func,p.func,p.string,p.object,p.string;function et({vendorCode:o}){O();const h=H(),n=I();i.useState([]);const[a,b]=i.useState([]),[g,t]=i.useState([]),[x,r]=i.useState([]),d={week:["Mon","Tue","Web","Thu","Fri","Sat","Sun"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:["2018","2019","2020","2021","2022"]};i.useEffect(()=>{c(),f()},[]),i.useEffect(()=>{const s=a==null?void 0:a.map((m,z)=>(m==null?void 0:m.category)!=="Distributor"?{label:q(m==null?void 0:m.category),value:m==null?void 0:m.count}:null).filter(m=>m!==null);r(s)},[a]);function c(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(s=>{b(s.data.data)})}function f(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(s=>{t(s.data.data)})}const y=["placed","accepted","declined"],l=g.filter(s=>y.includes(s.nccf_order_status)),C=[];return l.map(s=>C.push({label:M(s==null?void 0:s.nccf_order_status),value:(s==null?void 0:s["COUNT(id)"])||0})),e.jsx(L,{maxWidth:h.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[a&&a.map((s,m)=>(s==null?void 0:s.category)!=="Distributor"&&e.jsx(w,{xs:12,md:3,children:e.jsx(W,{title:q(s==null?void 0:s.category),total:(s==null?void 0:s.count)||0,chart:{}})})),g&&l.map((s,m)=>(s==null?void 0:s.category)!=="Distributor"&&e.jsx(w,{xs:12,md:4,children:e.jsx(W,{title:M(s==null?void 0:s.nccf_order_status),total:(s==null?void 0:s["COUNT(id)"])||0,chart:{}})})),e.jsx(w,{xs:12,md:6,lg:4,children:x!==[]&&e.jsx(K,{title:"CSP distribution",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:x}})}),e.jsx(w,{xs:12,md:6,lg:8,children:e.jsx(Y,{title:"Orders",chart:{labels:d,colors:[n.palette.primary.main,n.palette.error.main,n.palette.warning.main],series:[{type:"Week",data:[{name:"Bharat Daal",data:[20,34,48,65,37,48,9]},{name:"Bharat Aata",data:[10,34,13,26,27,28,18]},{name:"Bharat Rice",data:[10,14,13,16,17,18,28]}]},{type:"Month",data:[{name:"Bharat Daal",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Aata",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Rice",data:[10,34,13,56,77,88,99,77,45,12,43,34]}]},{type:"Year",data:[{name:"Bharat Daal",data:[10,34,13,56,77]},{name:"Bharat Aata",data:[10,34,13,56,77]},{name:"Bharat Rice",data:[10,34,13,56,77]}]}]}})})]})})}function st(){const{vendor:o}=O(),h=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),h==="other-login"?e.jsx(Xe,{}):(o==null?void 0:o.category)==="branch"?e.jsx(Ge,{}):e.jsx(et,{})]})}export{st as default};
