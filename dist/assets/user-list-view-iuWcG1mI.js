import{u as v,r,f as z,j as s,bs as Q,cW as P,bt as V,F as Y,bu as $,N as J,g as K,bv as M,D as R,K as B,M as F,cn as X,aF as Z,a as G,c as D,cX as ee,cY as se,aJ as te,C as oe,q as E,cu as ae,R as ne,i as A,cZ as le,c_ as re,c$ as ce,bQ as ie,d0 as de,c9 as ue,h as me,bR as he,bS as ge,bT as xe,bU as be,d1 as pe,d2 as fe,d3 as Ce,d4 as ye,d5 as je,d6 as we,d7 as Re}from"./index-l-xNXbr2.js";function Se({editDialogOpen:o,setEditDialogOpen:m,editData:a,dataFiltered:C,fetchAllOrdersDemo:b,commodities:i}){const{vendor:e}=v();r.useState({});const g=z({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:n,handleSubmit:h,formState:{isSubmitting:p}}=g;r.useEffect(()=>{a&&n({csp_code:a==null?void 0:a.csp_code,commodity:a==null?void 0:a.commodity,quantity:a==null?void 0:a.quantity})},[a]);const y=async d=>{m(!1);const f={...d,csp_code:e.csp_code,mode:"test",status:"0"};try{const x=await B.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",f);x.data.status=="201"?(F("Order added successfully!"),b()):x.data.status=="400"&&F("Failed to add order.",{variant:"error"})}catch(x){console.error("Order creation error:",x),F("Order creation failed.",{variant:"error"})}};return s.jsx(Q,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>m(!1),children:s.jsxs(P,{sx:{py:5,px:3},children:[s.jsx(V,{children:"Edit Order"}),s.jsxs(Y,{methods:g,children:[s.jsxs($,{maxWidth:"lg ",children:[s.jsx(P,{mb:2,mt:1,children:s.jsx(J,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:i.map(d=>d==null?void 0:d.commodity_name),getOptionLabel:d=>d})}),s.jsx(P,{mt:2,children:s.jsx(K,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),s.jsxs(M,{children:[s.jsx(R,{onClick:()=>m(!1),variant:"outlined",color:"inherit",children:"Cancel"}),s.jsx(R,{variant:"contained",onClick:h(y),children:"Save"})]})]})]})})}const Pe=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],T={name:"",commodity:[],order_status:[],status:"all"};function _e({tableData:o,fetchAllOrdersDemo:m}){const{enqueueSnackbar:a}=X(),C=Z(),b=G(),i=D(),e=ee(),[g,n]=r.useState(!1),[h,p]=r.useState(0),[y,d]=r.useState([]),[f,x]=r.useState(T),[_,O]=r.useState({}),{vendor:u}=v();r.useEffect(()=>{q()},[]);const c=Fe({inputData:o,comparator:se(e.order,e.orderBy),filters:f});function q(){B.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity/${u==null?void 0:u.category}`).then(t=>{var l;d((l=t.data)==null?void 0:l.data)})}const j=c.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage),U=e.dense?56:76,k=!te(T,f),W=!c.length&&k||!c.length,w=r.useCallback((t,l)=>{e.onResetPage(),x(S=>({...S,[t]:l}))},[e]),L=r.useCallback(()=>{x(T)},[]),I=r.useCallback(t=>{const l=o.filter(S=>S.id!==t);a("Delete success!"),setTableData(l),e.onUpdatePageDeleteRow(j.length)},[j.length,a,e,o]),H=r.useCallback(()=>{const t=o.filter(l=>!e.selected.includes(l.id));a("Delete success!"),setTableData(t),e.onUpdatePageDeleteRows({totalRowsInPage:j.length,totalRowsFiltered:c.length})},[c.length,j.length,a,e,o]),N=r.useCallback(t=>{p(t==null?void 0:t.id),O(t)},[b]);return r.useCallback((t,l)=>{w("status",l)},[w]),r.useCallback(t=>{setTableData(l=>[...l,t])},[a]),s.jsxs(s.Fragment,{children:[s.jsxs(oe,{maxWidth:C.themeStretch?!1:"xxl",children:[(u==null?void 0:u.nccf_branch_status)!=="1"&&s.jsx(E,{sx:{mb:2,p:1.5,color:"#b71d18",backgroundColor:"#FFE4DE"},children:"Account approval is pending from the Branch, You can place the orders after account approval"}),s.jsx(ae,{heading:"Orders",links:[{name:""}],action:s.jsx(R,{disabled:(u==null?void 0:u.nccf_branch_status)!="1",component:ne,variant:"contained",startIcon:s.jsx(A,{icon:"mingcute:add-line"}),onClick:()=>{n(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),s.jsxs(E,{children:[s.jsx(le,{filters:f,onFilters:w,commodityOptions:y,orderStatusOptions:re}),k&&s.jsx(ce,{filters:f,onFilters:w,onResetFilters:L,results:c.length,sx:{p:2.5,pt:0}}),s.jsxs(ie,{sx:{position:"relative",overflow:"unset"},children:[s.jsx(de,{dense:!0,numSelected:e.selected.length,rowCount:c.length,onSelectAllRows:t=>e.onSelectAllRows(t,c.map(l=>l.id)),action:s.jsx(ue,{title:"Delete",children:s.jsx(me,{color:"primary",onClick:i.onTrue,children:s.jsx(A,{icon:"solar:trash-bin-trash-bold"})})})}),s.jsx(he,{children:s.jsxs(ge,{size:e.dense?"small":"medium",sx:{minWidth:960},children:[s.jsx(xe,{order:e.order,orderBy:e.orderBy,headLabel:Pe,rowCount:c.length,numSelected:e.selected.length,onSort:e.onSort,onSelectAllRows:t=>e.onSelectAllRows(t,c.map(l=>l.id))}),s.jsxs(be,{children:[c.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage).map((t,l)=>s.jsx(pe,{row:{...t,index:l},selected:e.selected.includes(t.id),onSelectRow:()=>e.onSelectRow(t.id),onDeleteRow:()=>I(t.id),onEditRow:()=>N(t)},t.id)),s.jsx(fe,{height:U,emptyRows:Ce(e.page,e.rowsPerPage,o.length)}),s.jsx(ye,{isNotFound:W})]})]})}),s.jsx(je,{count:c.length,page:e.page,rowsPerPage:e.rowsPerPage,onPageChange:e.onChangePage,onRowsPerPageChange:e.onChangeRowsPerPage,dense:e.dense,onChangeDense:e.onChangeDense})]})]})]}),s.jsx(we,{open:i.value,onClose:i.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:s.jsx(R,{variant:"contained",color:"error",onClick:()=>{H(),i.onFalse()},children:"Delete"})}),s.jsx(Re,{dialogOpen:g,setDialogOpen:n,editId:_,fetchAllOrdersDemo:m,commodities:y}),s.jsx(Se,{editDialogOpen:h,setEditDialogOpen:p,editData:_,dataFiltered:c,commodities:y,fetchAllOrdersDemo:m})]})}function Fe({inputData:o,comparator:m,filters:a}){const{name:C,status:b,commodity:i,order_status:e}=a,g=o.map((n,h)=>[n,h]);return g.sort((n,h)=>{const p=m(n[0],h[0]);return p!==0?p:n[1]-h[1]}),o=g.map(n=>n[0]),C&&(o=o.filter(n=>n.commodity.toLowerCase().includes(C.toLowerCase()))),b!=="all"&&(o=o.filter(n=>n.status===b)),i.length&&(o=o.filter(n=>i.includes(n.commodity))),e.length&&(o=o.filter(n=>e.includes(n.nccf_order_status))),o}export{_e as U};
