import{r as i,u as v,K as T,f as oe,j as e,bs as re,cP as B,bt as ne,F as ae,bu as le,N as ce,g as ie,bv as de,D as k,M as W,cn as ue,aF as H,a as he,c as me,cQ as pe,cR as ge,aJ as xe,C as L,cu as fe,R as be,i as D,q as _,cS as ye,cT as je,cU as Ce,cV as we,bQ as Se,cW as Te,c9 as Re,h as Pe,bR as Oe,bS as ke,bT as ve,bU as _e,cX as Ae,cY as Fe,cZ as Be,c_ as We,c$ as Ee,d0 as De,d1 as He,a8 as h,ah as S,d2 as O,a2 as I,d3 as R,B as $,T as z,d4 as V,bK as G,ay as Le,d5 as J,br as Ie,d6 as ze,bd as Ne,bw as Ue,cd as qe,d7 as N,d8 as U,H as Me,d9 as $e}from"./index-GjnHg5oM.js";import{A as Ve}from"./analytics-widget-summary-47kFAXVu.js";function Ge({editDialogOpen:o,setEditDialogOpen:m,editData:n,dataFiltered:a,fetchAllOrdersDemo:f}){const[p,t]=i.useState([]),{vendor:x}=v();i.useState({}),i.useEffect(()=>{r()},[]);function r(){T.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(w=>{var g;t((g=w.data)==null?void 0:g.data)})}const d=oe({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:l,handleSubmit:C,formState:{isSubmitting:y}}=d;i.useEffect(()=>{n&&l({csp_code:n==null?void 0:n.csp_code,commodity:n==null?void 0:n.commodity,quantity:n==null?void 0:n.quantity})},[n]);const c=async w=>{m(!1);const g={...w,csp_code:x.csp_code,mode:"test",status:"0"};try{const s=await T.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",g);s.data.status=="201"?(W("Order added successfully!"),f()):s.data.status=="400"&&W("Failed to add order.",{variant:"error"})}catch(s){console.error("Order creation error:",s),W("Order creation failed.",{variant:"error"})}};return e.jsx(re,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>m(!1),children:e.jsxs(B,{sx:{py:5,px:3},children:[e.jsx(ne,{children:"Edit Order"}),e.jsxs(ae,{methods:d,children:[e.jsxs(le,{maxWidth:"lg ",children:[e.jsx(B,{mb:2,mt:1,children:e.jsx(ce,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:p.map(w=>w==null?void 0:w.commodity_name),getOptionLabel:w=>w})}),e.jsx(B,{mt:2,children:e.jsx(ie,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(de,{children:[e.jsx(k,{onClick:()=>m(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(k,{variant:"contained",onClick:C(c),children:"Save"})]})]})]})})}const Je=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],E={name:"",commodity:[],order_status:[],status:"all"};function Qe({tableData:o,fetchAllOrdersDemo:m}){const{enqueueSnackbar:n}=ue(),a=H(),f=he(),p=me(),t=pe(),[x,r]=i.useState(!1),[d,l]=i.useState(0),[C,y]=i.useState(E),[c,w]=i.useState({}),g=Ke({inputData:o,comparator:ge(t.order,t.orderBy),filters:C}),s=g.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),b=t.dense?56:76,A=!xe(E,C),X=!g.length&&A||!g.length,P=i.useCallback((u,j)=>{t.onResetPage(),y(F=>({...F,[u]:j}))},[t]),Z=i.useCallback(()=>{y(E)},[]),ee=i.useCallback(u=>{const j=o.filter(F=>F.id!==u);n("Delete success!"),setTableData(j),t.onUpdatePageDeleteRow(s.length)},[s.length,n,t,o]),te=i.useCallback(()=>{const u=o.filter(j=>!t.selected.includes(j.id));n("Delete success!"),setTableData(u),t.onUpdatePageDeleteRows({totalRowsInPage:s.length,totalRowsFiltered:g.length})},[g.length,s.length,n,t,o]),se=i.useCallback(u=>{l(u==null?void 0:u.id),w(u)},[f]);return i.useCallback((u,j)=>{P("status",j)},[P]),i.useCallback(u=>{setTableData(j=>[...j,u])},[n]),e.jsxs(e.Fragment,{children:[e.jsxs(L,{maxWidth:a.themeStretch?!1:"xxl",children:[e.jsx(fe,{heading:"Orders",links:[{name:""}],action:e.jsx(k,{component:be,variant:"contained",startIcon:e.jsx(D,{icon:"mingcute:add-line"}),onClick:()=>{r(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(_,{children:[e.jsx(ye,{filters:C,onFilters:P,commodityOptions:je,orderStatusOptions:Ce}),A&&e.jsx(we,{filters:C,onFilters:P,onResetFilters:Z,results:g.length,sx:{p:2.5,pt:0}}),e.jsxs(Se,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Te,{dense:!0,numSelected:t.selected.length,rowCount:g.length,onSelectAllRows:u=>t.onSelectAllRows(u,g.map(j=>j.id)),action:e.jsx(Re,{title:"Delete",children:e.jsx(Pe,{color:"primary",onClick:p.onTrue,children:e.jsx(D,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(Oe,{children:e.jsxs(ke,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ve,{order:t.order,orderBy:t.orderBy,headLabel:Je,rowCount:g.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:u=>t.onSelectAllRows(u,g.map(j=>j.id))}),e.jsxs(_e,{children:[g.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((u,j)=>e.jsx(Ae,{row:{...u,index:j},selected:t.selected.includes(u.id),onSelectRow:()=>t.onSelectRow(u.id),onDeleteRow:()=>ee(u.id),onEditRow:()=>se(u)},u.id)),e.jsx(Fe,{height:b,emptyRows:Be(t.page,t.rowsPerPage,o.length)}),e.jsx(We,{isNotFound:X})]})]})}),e.jsx(Ee,{count:g.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(De,{open:p.value,onClose:p.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(k,{variant:"contained",color:"error",onClick:()=>{te(),p.onFalse()},children:"Delete"})}),e.jsx(He,{dialogOpen:x,setDialogOpen:r,editId:c,fetchAllOrdersDemo:m}),e.jsx(Ge,{editDialogOpen:d,setEditDialogOpen:l,editData:c,dataFiltered:g,fetchAllOrdersDemo:m})]})}function Ke({inputData:o,comparator:m,filters:n}){const{name:a,status:f,commodity:p,order_status:t}=n,x=o.map((r,d)=>[r,d]);return x.sort((r,d)=>{const l=m(r[0],d[0]);return l!==0?l:r[1]-d[1]}),o=x.map(r=>r[0]),a&&(o=o.filter(r=>r.commodity.toLowerCase().includes(a.toLowerCase()))),f!=="all"&&(o=o.filter(r=>r.status===f)),p.length&&(o=o.filter(r=>p.includes(r.commodity))),t.length&&(o=o.filter(r=>t.includes(r.nccf_order_status))),o}h.string,h.array,h.array,h.string;h.object;function Ye({vendorCode:o}){const{vendor:m}=v(),n=H(),[a,f]=i.useState({}),[p,t]=i.useState([]),[x,r]=i.useState(0);i.useEffect(()=>{m.csp_code&&(C(),l())},[x]);function d(){r(y=>y+1)}function l(){T.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${m.csp_code}/orders_stats`).then(y=>{var c;f((c=y.data)==null?void 0:c.data[0])})}function C(){T.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${m.csp_code}/orders`).then(y=>{var c;t((c=y.data)==null?void 0:c.data)})}return e.jsx(L,{maxWidth:n.themeStretch?!1:"xl",children:e.jsxs(S,{container:!0,spacing:3,children:[e.jsx(S,{xs:12,md:3,children:e.jsx(O,{title:"Total Orders",total:(a==null?void 0:a.total_orders)||"0"})}),e.jsx(S,{xs:12,md:3,children:e.jsx(O,{title:"Orders Pending",total:(a==null?void 0:a.placed_orders)||"0"})}),e.jsx(S,{xs:12,md:3,children:e.jsx(O,{title:"Orders Accepted",total:(a==null?void 0:a.accepted_orders)||"0"})}),e.jsx(S,{xs:12,md:3,children:e.jsx(O,{title:"Orders Declined",total:(a==null?void 0:a.declined_orders)||"0"})}),e.jsx(S,{xs:12,lg:12,children:e.jsx(Qe,{tableData:p,fetchAllOrdersDemo:d})})]})})}function Q({title:o,percent:m,total:n,chart:a,sx:f,...p}){const t=I(),{colors:x=[t.palette.primary.light,t.palette.primary.main],series:r,options:d}=a;return{colors:x.map(l=>l[1]),fill:(x[0],x[1]),...d},e.jsx(_,{sx:{display:"flex",alignItems:"center",p:3,...f},...p,children:e.jsxs($,{sx:{mt:1,mb:1,display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[e.jsx(z,{sx:{fontSize:"1.2rem",fontWeight:500},children:o}),e.jsx(z,{sx:{fontSize:"38px",fontWeight:700},children:R(n)})]})})}Q.propTypes={chart:h.object,percent:h.number,sx:h.object,title:h.string,total:h.number};const q=400,M=72,Xe=Le(J)(({theme:o})=>({height:q,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:M,borderTop:`dashed 1px ${o.palette.divider}`,top:`calc(${q-M}px) !important`}}));function K({title:o,subheader:m,chart:n,...a}){const f=I(),{colors:p,series:t,options:x}=n,r=t.map(l=>l.value),d=V({chart:{sparkline:{enabled:!0}},colors:p,labels:t.map(l=>l.label),stroke:{colors:[f.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:l=>R(l),title:{formatter:l=>`${l}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:l=>R(l)},total:{formatter:l=>{const C=l.globals.seriesTotals.reduce((y,c)=>y+c,0);return R(C)}}}}}},...x});return e.jsxs(_,{...a,children:[e.jsx(G,{title:o,subheader:m,sx:{mb:5}}),e.jsx(Xe,{dir:"ltr",type:"donut",series:r,options:d,width:"100%",height:280})]})}K.propTypes={chart:h.object,subheader:h.string,title:h.string};function Y({title:o,subheader:m,chart:n,...a}){const{labels:f,colors:p,series:t,options:x}=n,r=Ie(),[d,l]=i.useState("Week"),C=V({chart:{stacked:!0},colors:p,stroke:{width:0},xaxis:{categories:d==="Week"&&f.week||d==="Month"&&f.month||f.year},tooltip:{y:{formatter:c=>ze(c)}},plotOptions:{bar:{borderRadius:d==="Week"&&8||d==="Month"&&6||10,columnWidth:"20%"}},...x}),y=i.useCallback(c=>{r.onClose(),l(c)},[r]);return e.jsxs(e.Fragment,{children:[e.jsxs(_,{...a,children:[e.jsx(G,{title:o,subheader:m,action:e.jsxs(Ne,{onClick:r.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[d,e.jsx(D,{width:16,icon:r.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),t.map(c=>e.jsx($,{sx:{mt:3,mx:3},children:c.type===d&&e.jsx(J,{dir:"ltr",type:"bar",series:c.data,options:C,width:"100%",height:375})},c.type))]}),e.jsx(Ue,{open:r.open,onClose:r.onClose,sx:{width:140},children:t.map(c=>e.jsx(qe,{selected:c.type===d,onClick:()=>y(c.type),children:c.type},c.type))})]})}Y.propTypes={chart:h.object,subheader:h.string,title:h.string};h.bool,h.string,h.func,h.func,h.string,h.object,h.string;function Ze({vendorCode:o}){v();const m=H(),n=I();i.useState([]);const[a,f]=i.useState([]),[p,t]=i.useState([]),[x,r]=i.useState([]),d={week:["Mon","Tue","Web","Thu","Fri","Sat","Sun"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:["2018","2019","2020","2021","2022"]};i.useEffect(()=>{l(),C()},[]),i.useEffect(()=>{const s=a==null?void 0:a.map((b,A)=>(b==null?void 0:b.category)!=="Distributor"?{label:N(b==null?void 0:b.category),value:b==null?void 0:b.count}:null).filter(b=>b!==null);r(s)},[a]);function l(){T.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(s=>{f(s.data.data)})}function C(){T.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(s=>{t(s.data.data)})}const y=["placed","accepted","declined"],c=["primary","info","warning","error"],w=p.filter(s=>y.includes(s.nccf_order_status)),g=[];return w.map(s=>g.push({label:U(s==null?void 0:s.nccf_order_status),value:(s==null?void 0:s["COUNT(id)"])||0})),e.jsx(L,{maxWidth:m.themeStretch?!1:"xl",children:e.jsxs(S,{container:!0,spacing:3,children:[a&&a.map((s,b)=>e.jsx(S,{xs:12,md:3,children:e.jsx(Ve,{title:N(s==null?void 0:s.category),total:(s==null?void 0:s.count)||0,color:c[b]})})),p&&w.map((s,b)=>e.jsx(S,{xs:12,md:4,children:e.jsx(Q,{title:U(s==null?void 0:s.nccf_order_status),total:(s==null?void 0:s["COUNT(id)"])||0,chart:{}})})),e.jsx(S,{xs:12,md:6,lg:4,children:x!==[]&&e.jsx(K,{title:"CSP distribution",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:x}})}),e.jsx(S,{xs:12,md:6,lg:8,children:e.jsx(Y,{title:"Orders",chart:{labels:d,colors:[n.palette.primary.main,n.palette.error.main,n.palette.warning.main],series:[{type:"Week",data:[{name:"Bharat Daal",data:[20,34,48,65,37,48,9]},{name:"Bharat Aata",data:[10,34,13,26,27,28,18]},{name:"Bharat Rice",data:[10,14,13,16,17,18,28]}]},{type:"Month",data:[{name:"Bharat Daal",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Aata",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Rice",data:[10,34,13,56,77,88,99,77,45,12,43,34]}]},{type:"Year",data:[{name:"Bharat Daal",data:[10,34,13,56,77]},{name:"Bharat Aata",data:[10,34,13,56,77]},{name:"Bharat Rice",data:[10,34,13,56,77]}]}]}})})]})})}function st(){const{vendor:o}=v(),m=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),m==="other-login"?e.jsx(Ye,{}):(o==null?void 0:o.category)==="branch"?e.jsx($e,{}):e.jsx(Ze,{})]})}export{st as default};
