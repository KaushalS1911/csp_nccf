import{r as d,u as O,K as S,f as te,j as e,bs as se,cP as A,bt as oe,F as ae,bu as re,N as ne,g as le,bv as ce,D as k,M as B,cn as ie,aF as L,a as de,c as he,cQ as ue,cR as me,aJ as pe,C as I,cu as ge,R as xe,i as W,q as _,cS as be,cT as fe,cU as je,cV as ye,bQ as Ce,cW as we,c9 as Se,h as Te,bR as ve,bS as Re,bT as Pe,bU as ke,cX as Oe,cY as _e,cZ as Fe,c_ as Ae,c$ as Be,d0 as De,d1 as Ee,a8 as m,ah as w,d2 as P,a2 as z,d3 as v,B as $,T as D,S as We,ai as He,d4 as M,d5 as V,bK as G,ay as Le,br as Ie,d6 as ze,bd as Me,bw as Ne,cd as qe,d7 as Ue,H as $e,d8 as Ve}from"./index-oVXCsjp_.js";function Ge({editDialogOpen:a,setEditDialogOpen:h,editData:r,dataFiltered:n,fetchAllOrdersDemo:f}){const[g,t]=d.useState([]),{vendor:x}=O();d.useState({}),d.useEffect(()=>{o()},[]);function o(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(C=>{var p;t((p=C.data)==null?void 0:p.data)})}const i=te({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:l,handleSubmit:b,formState:{isSubmitting:j}}=i;d.useEffect(()=>{r&&l({csp_code:r==null?void 0:r.csp_code,commodity:r==null?void 0:r.commodity,quantity:r==null?void 0:r.quantity})},[r]);const c=async C=>{h(!1);const p={...C,csp_code:x.csp_code,mode:"test",status:"0"};try{const s=await S.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",p);s.data.status=="201"?(B("Order added successfully!"),f()):s.data.status=="400"&&B("Failed to add order.",{variant:"error"})}catch(s){console.error("Order creation error:",s),B("Order creation failed.",{variant:"error"})}};return e.jsx(se,{open:a,fullWidth:!0,maxWidth:"md",onClose:()=>h(!1),children:e.jsxs(A,{sx:{py:5,px:3},children:[e.jsx(oe,{children:"Edit Order"}),e.jsxs(ae,{methods:i,children:[e.jsxs(re,{maxWidth:"lg ",children:[e.jsx(A,{mb:2,mt:1,children:e.jsx(ne,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:g.map(C=>C==null?void 0:C.commodity_name),getOptionLabel:C=>C})}),e.jsx(A,{mt:2,children:e.jsx(le,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(ce,{children:[e.jsx(k,{onClick:()=>h(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(k,{variant:"contained",onClick:b(c),children:"Save"})]})]})]})})}const Je=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],E={name:"",commodity:[],order_status:[],status:"all"};function Qe({tableData:a,fetchAllOrdersDemo:h}){const{enqueueSnackbar:r}=ie(),n=L(),f=de(),g=he(),t=ue(),[x,o]=d.useState(!1),[i,l]=d.useState(0),[b,j]=d.useState(E),[c,C]=d.useState({}),p=Ke({inputData:a,comparator:me(t.order,t.orderBy),filters:b}),s=p.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),T=t.dense?56:76,N=!pe(E,b),K=!p.length&&N||!p.length,R=d.useCallback((u,y)=>{t.onResetPage(),j(F=>({...F,[u]:y}))},[t]),Y=d.useCallback(()=>{j(E)},[]),X=d.useCallback(u=>{const y=a.filter(F=>F.id!==u);r("Delete success!"),setTableData(y),t.onUpdatePageDeleteRow(s.length)},[s.length,r,t,a]),Z=d.useCallback(()=>{const u=a.filter(y=>!t.selected.includes(y.id));r("Delete success!"),setTableData(u),t.onUpdatePageDeleteRows({totalRowsInPage:s.length,totalRowsFiltered:p.length})},[p.length,s.length,r,t,a]),ee=d.useCallback(u=>{l(u==null?void 0:u.id),C(u)},[f]);return d.useCallback((u,y)=>{R("status",y)},[R]),d.useCallback(u=>{setTableData(y=>[...y,u])},[r]),e.jsxs(e.Fragment,{children:[e.jsxs(I,{maxWidth:n.themeStretch?!1:"xxl",children:[e.jsx(ge,{heading:"Orders",links:[{name:""}],action:e.jsx(k,{component:xe,variant:"contained",startIcon:e.jsx(W,{icon:"mingcute:add-line"}),onClick:()=>{o(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(_,{children:[e.jsx(be,{filters:b,onFilters:R,commodityOptions:fe,orderStatusOptions:je}),N&&e.jsx(ye,{filters:b,onFilters:R,onResetFilters:Y,results:p.length,sx:{p:2.5,pt:0}}),e.jsxs(Ce,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(we,{dense:!0,numSelected:t.selected.length,rowCount:p.length,onSelectAllRows:u=>t.onSelectAllRows(u,p.map(y=>y.id)),action:e.jsx(Se,{title:"Delete",children:e.jsx(Te,{color:"primary",onClick:g.onTrue,children:e.jsx(W,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ve,{children:e.jsxs(Re,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:t.order,orderBy:t.orderBy,headLabel:Je,rowCount:p.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:u=>t.onSelectAllRows(u,p.map(y=>y.id))}),e.jsxs(ke,{children:[p.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((u,y)=>e.jsx(Oe,{row:{...u,index:y},selected:t.selected.includes(u.id),onSelectRow:()=>t.onSelectRow(u.id),onDeleteRow:()=>X(u.id),onEditRow:()=>ee(u)},u.id)),e.jsx(_e,{height:T,emptyRows:Fe(t.page,t.rowsPerPage,a.length)}),e.jsx(Ae,{isNotFound:K})]})]})}),e.jsx(Be,{count:p.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(De,{open:g.value,onClose:g.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(k,{variant:"contained",color:"error",onClick:()=>{Z(),g.onFalse()},children:"Delete"})}),e.jsx(Ee,{dialogOpen:x,setDialogOpen:o,editId:c,fetchAllOrdersDemo:h}),e.jsx(Ge,{editDialogOpen:i,setEditDialogOpen:l,editData:c,dataFiltered:p,fetchAllOrdersDemo:h})]})}function Ke({inputData:a,comparator:h,filters:r}){const{name:n,status:f,commodity:g,order_status:t}=r,x=a.map((o,i)=>[o,i]);return x.sort((o,i)=>{const l=h(o[0],i[0]);return l!==0?l:o[1]-i[1]}),a=x.map(o=>o[0]),n&&(a=a.filter(o=>o.commodity.toLowerCase().includes(n.toLowerCase()))),f!=="all"&&(a=a.filter(o=>o.status===f)),g.length&&(a=a.filter(o=>g.includes(o.commodity))),t.length&&(a=a.filter(o=>t.includes(o.nccf_order_status))),a}m.string,m.array,m.array,m.string;m.object;function Ye({vendorCode:a}){const{vendor:h}=O(),r=L(),[n,f]=d.useState({}),[g,t]=d.useState([]),[x,o]=d.useState(0);d.useEffect(()=>{h.csp_code&&(b(),l())},[x]);function i(){o(j=>j+1)}function l(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders_stats`).then(j=>{var c;f((c=j.data)==null?void 0:c.data[0])})}function b(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders`).then(j=>{var c;t((c=j.data)==null?void 0:c.data)})}return e.jsx(I,{maxWidth:r.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Total Orders",total:(n==null?void 0:n.total_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Pending",total:(n==null?void 0:n.placed_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Accepted",total:(n==null?void 0:n.accepted_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Declined",total:(n==null?void 0:n.declined_orders)||"0"})}),e.jsx(w,{xs:12,lg:12,children:e.jsx(Qe,{tableData:g,fetchAllOrdersDemo:i})})]})})}function H({title:a,percent:h,total:r,chart:n,sx:f,...g}){const t=z(),{colors:x=[t.palette.primary.light,t.palette.primary.main],series:o,options:i}=n,l={colors:x.map(b=>b[1]),fill:{type:"gradient",gradient:{colorStops:[{offset:0,color:x[0],opacity:1},{offset:100,color:x[1],opacity:1}]}},chart:{sparkline:{enabled:!0}},plotOptions:{bar:{columnWidth:"68%",borderRadius:2}},tooltip:{x:{show:!1},y:{formatter:b=>v(b),title:{formatter:()=>""}},marker:{show:!1}},...i};return e.jsxs(_,{sx:{display:"flex",alignItems:"center",p:3,...f},...g,children:[e.jsxs($,{sx:{flexGrow:1},children:[e.jsx(D,{variant:"subtitle2",children:a}),e.jsx(We,{direction:"row",alignItems:"center",sx:{mt:2,mb:1},children:e.jsxs(D,{component:"div",variant:"subtitle2",children:[h>0&&"+",He(h)]})}),e.jsx(D,{variant:"h3",children:v(r)})]}),e.jsx(M,{dir:"ltr",type:"bar",series:[{data:o}],options:l,width:60,height:36})]})}H.propTypes={chart:m.object,percent:m.number,sx:m.object,title:m.string,total:m.number};const q=400,U=72,Xe=Le(M)(({theme:a})=>({height:q,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:U,borderTop:`dashed 1px ${a.palette.divider}`,top:`calc(${q-U}px) !important`}}));function J({title:a,subheader:h,chart:r,...n}){const f=z(),{colors:g,series:t,options:x}=r,o=t.map(l=>l.value),i=V({chart:{sparkline:{enabled:!0}},colors:g,labels:t.map(l=>l.label),stroke:{colors:[f.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:l=>v(l),title:{formatter:l=>`${l}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:l=>v(l)},total:{formatter:l=>{const b=l.globals.seriesTotals.reduce((j,c)=>j+c,0);return v(b)}}}}}},...x});return e.jsxs(_,{...n,children:[e.jsx(G,{title:a,subheader:h,sx:{mb:5}}),e.jsx(Xe,{dir:"ltr",type:"donut",series:o,options:i,width:"100%",height:280})]})}J.propTypes={chart:m.object,subheader:m.string,title:m.string};function Q({title:a,subheader:h,chart:r,...n}){const{labels:f,colors:g,series:t,options:x}=r,o=Ie(),[i,l]=d.useState("Week"),b=V({chart:{stacked:!0},colors:g,stroke:{width:0},xaxis:{categories:i==="Week"&&f.week||i==="Month"&&f.month||f.year},tooltip:{y:{formatter:c=>ze(c)}},plotOptions:{bar:{borderRadius:i==="Week"&&8||i==="Month"&&6||10,columnWidth:"20%"}},...x}),j=d.useCallback(c=>{o.onClose(),l(c)},[o]);return e.jsxs(e.Fragment,{children:[e.jsxs(_,{...n,children:[e.jsx(G,{title:a,subheader:h,action:e.jsxs(Me,{onClick:o.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[i,e.jsx(W,{width:16,icon:o.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),t.map(c=>e.jsx($,{sx:{mt:3,mx:3},children:c.type===i&&e.jsx(M,{dir:"ltr",type:"bar",series:c.data,options:b,width:"100%",height:375})},c.type))]}),e.jsx(Ne,{open:o.open,onClose:o.onClose,sx:{width:140},children:t.map(c=>e.jsx(qe,{selected:c.type===i,onClick:()=>j(c.type),children:c.type},c.type))})]})}Q.propTypes={chart:m.object,subheader:m.string,title:m.string};m.bool,m.string,m.func,m.func,m.string,m.object,m.string;function Ze({vendorCode:a}){const{vendor:h}=O(),r=L(),n=z(),[f,g]=d.useState([]),[t,x]=d.useState([]),[o,i]=d.useState([]),l={week:["Mon","Tue","Web","Thu","Fri","Sat","Sun"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:["2018","2019","2020","2021","2022"]};d.useEffect(()=>{h.csp_code&&c(),b(),j()},[]);function b(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(s=>{x(s.data.data)})}function j(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(s=>{i(s.data.data)})}function c(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders`).then(s=>{var T;g((T=s.data)==null?void 0:T.data)})}const C=["placed","accepted","declined"],p=o.filter(s=>C.includes(s.nccf_order_status));return e.jsx(I,{maxWidth:r.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[t&&t.map((s,T)=>(s==null?void 0:s.category)!=="Distributor"&&e.jsx(w,{xs:12,md:3,children:e.jsx(H,{title:Ue(s==null?void 0:s.category),total:s==null?void 0:s.count,chart:{}})})),o&&p.map((s,T)=>(s==null?void 0:s.category)!=="Distributor"&&e.jsx(w,{xs:12,md:4,children:e.jsx(H,{title:s==null?void 0:s.nccf_order_status,total:s==null?void 0:s["COUNT(id)"],chart:{}})})),e.jsx(w,{xs:12,md:6,lg:4,children:e.jsx(J,{title:"Categories",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:[{label:"Miller",value:12244},{label:"Distributor",value:53345},{label:"Miller + Distributor",value:44313},{label:"Society/Co-operative",value:78343}]}})}),e.jsx(w,{xs:12,md:6,lg:8,children:e.jsx(Q,{title:"Orders",chart:{labels:l,colors:[n.palette.primary.main,n.palette.error.main,n.palette.warning.main],series:[{type:"Week",data:[{name:"Bharat Daal",data:[20,34,48,65,37,48,9]},{name:"Bharat Aata",data:[10,34,13,26,27,28,18]},{name:"Bharat Rice",data:[10,14,13,16,17,18,28]}]},{type:"Month",data:[{name:"Bharat Daal",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Aata",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Rice",data:[10,34,13,56,77,88,99,77,45,12,43,34]}]},{type:"Year",data:[{name:"Bharat Daal",data:[10,34,13,56,77]},{name:"Bharat Aata",data:[10,34,13,56,77]},{name:"Bharat Rice",data:[10,34,13,56,77]}]}]}})})]})})}function tt(){const{vendor:a}=O(),h=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx($e,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),h==="other-login"?e.jsx(Ye,{}):(a==null?void 0:a.category)==="branch"?e.jsx(Ve,{}):e.jsx(Ze,{})]})}export{tt as default};
