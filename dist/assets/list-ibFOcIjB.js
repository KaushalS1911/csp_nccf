import{cn as xe,c as ge,a as be,aF as pe,u as K,r as l,d_ as U,K as y,aJ as je,j as e,C as Ce,ah as V,cT as _e,cS as ye,cu as we,p as q,d$ as He,q as Se,e0 as De,a4 as ve,e1 as Ae,aA as Y,dJ as Oe,dK as Be,E as oe,cH as ie,cI as de,cJ as he,cd as ue,e2 as $e,S as Re,D as N,i as ke,dO as Fe,dQ as Te,e3 as We,e4 as Le,aV as Q,d6 as Ne,e5 as J,e6 as Pe,bN as G,n as Ge,e7 as Ue,e8 as Ve,e9 as qe,ea as Ye,eb as Qe,H as Je}from"./index-olk6yeAs.js";import{U as Ke}from"./user-list-view-jGsFoHKv.js";const ce={publish:[],stock:[],commodity:[],status:"all",branch:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null,category:[]},Xe={category:!1},Ze=["category","actions"];function et({singleCode:s}){const{enqueueSnackbar:f}=xe(),m=ge(),D=be(),j=pe(),{vendor:r}=K(),[h,x]=l.useState([]),[o,d]=l.useState(ce),[g,p]=l.useState([]),[v,w]=l.useState(!1),[C,n]=l.useState({}),[M,fe]=l.useState(!1),[I,X]=l.useState(Xe),[Z,ee]=l.useState([]),[O,_]=l.useState([]),[z,te]=l.useState([]),P=U(o.startDate,o.endDate),S=U(o.startDay,o.endDay),k=a=>{const i=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${a}/orders`;y.get(i).then(u=>{var R;return x((R=u==null?void 0:u.data)==null?void 0:R.data)}).catch(u=>console.log(u))};l.useEffect(()=>{r&&(y.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080//nccf/branch/${r==null?void 0:r.branch}/csp/list`).then(a=>{var R;const i=((R=a==null?void 0:a.data)==null?void 0:R.data)||[],u=[{name:"All",csp_code:"All"},...i];ee(u)}).catch(a=>console.log(a)),y.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${r==null?void 0:r.branch}/order`).then(a=>{var i;return x((i=a==null?void 0:a.data)==null?void 0:i.data)}).catch(a=>console.log(a)))},[]),l.useEffect(()=>{if(O==="All"){const a=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${r==null?void 0:r.branch}/order`;y.get(a).then(i=>{var u;return x((u=i==null?void 0:i.data)==null?void 0:u.data)}).catch(i=>console.log(i))}else k(O)},[O]);const B=tt({inputData:h,filters:o,dateError:P}),ae=l.useCallback(a=>{te(a.target.value),_(a.target.value)},[O]),H=!je(ce,o)||!!o.startDate&&!!o.endDate||!!o.startDay&&!!o.endDay,F=l.useCallback((a,i)=>{d(u=>({...u,[a]:i}))},[]),E=l.useCallback(()=>{d(ce)},[]);l.useCallback(a=>{const i=h.filter(u=>u.id!==a);f("Delete success!"),x(i)},[f,h]);const T=[{label:"accepted",count:0},{label:"declined",count:0},{label:"placed",count:0}],A=["primary","error","warning","error"];T.forEach(a=>{a.count=B.filter(i=>i.nccf_order_status===a.label).length});const se=[{value:"all",label:"All"},{value:"Bharat Aata",label:"Bharat Aata"},{value:"Bharat Daal",label:"Bharat Daal"},{value:"Bharat Rice",label:"Bharat Rice"}],$=l.useCallback(()=>{const a=h.filter(i=>!g.includes(i.id));f("Delete success!"),x(a)},[f,g,h]);l.useCallback(a=>{},[D]);const W=[{field:"seq_number",headerName:"SR No.",minWidth:200},{field:"name",headerName:"Name",width:250},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:a=>Pe(a.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:a=>e.jsx(G,{children:e.jsx(Y,{variant:"soft",color:a.row.nccf_order_status==="accepted"&&"success"||a.row.nccf_order_status==="placed"&&"warning"||a.row.nccf_order_status==="declined"&&"error"||"default",children:a.row.nccf_order_status==="accepted"?"Accepted":a.row.nccf_order_status==="declined"?"Declined":"Placed"})})}],le=l.useCallback((a,i)=>{F("status",i)},[F]),ne=()=>W.filter(a=>!Ze.includes(a.field)).map(a=>a.field);return e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{maxWidth:j.themeStretch?!1:"xl",children:[e.jsx(V,{container:!0,spacing:3,children:T.map((a,i)=>e.jsx(V,{item:!0,xs:12,md:4,mb:5,children:e.jsx(_e,{title:ye(a==null?void 0:a.label),total:(a==null?void 0:a.count)==0?"0":a.count,color:A[i],chart:{}})}))}),e.jsx(we,{heading:"Order List",links:[{name:"Dashboard",href:q.dashboard.root},{name:"Order",href:q.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),e.jsx(He,{getAllDocument:k,currentUser:C,open:v,setOpen:w,approve:M,cspCode:z}),e.jsxs(Se,{sx:{height:(B==null?void 0:B.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[e.jsx(De,{value:o.status,onChange:le,sx:{px:2.5,boxShadow:a=>`inset 0 -2px 0 0 ${ve(a.palette.grey[500],.08)}`},children:se.map(a=>e.jsx(Ae,{iconPosition:"end",value:a.value,label:a.label,icon:e.jsx(Y,{variant:(a.value==="all"||a.value===o.status)&&"filled"||"soft",color:a.value==="Bharat Aata"&&"success"||a.value==="Bharat Daal"&&"warning"||a.value==="Bharat Rice"&&"error"||"default",children:["Bharat Aata","Bharat Rice","Bharat Daal"].includes(a.value)?h.filter(i=>i.commodity===a.value).length:h.length})},a.value))}),e.jsx(Oe,{disableRowSelectionOnClick:!0,rows:B,columns:W,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:I,onColumnVisibilityModelChange:a=>X(a),slots:{toolbar:()=>e.jsx(e.Fragment,{children:e.jsxs(Be,{children:[e.jsxs(oe,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(ie,{children:"CSP"}),e.jsx(de,{value:O,onChange:ae,input:e.jsx(he,{label:"Type"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:Z.map(a=>e.jsx(ue,{value:a.csp_code,disabled:a.order_count===0,children:a.name},a.csp_code))})]}),H&&e.jsx($e,{filters:o,onFilters:F,onResetFilters:E,results:B.length,sx:{p:2.5,pt:0}}),e.jsxs(Re,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!g.length&&e.jsxs(N,{size:"small",color:"error",startIcon:e.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:m.onTrue,children:["Delete (",g.length,")"]}),e.jsx(Fe,{}),e.jsx(Te,{})]}),e.jsx(We,{filters:o,onFilters:F,roleOptions:Le,branchOptions:["hello"],dateError:P,dayError:S})]})}),noRowsOverlay:()=>e.jsx(Q,{title:"No Data"}),noResultsOverlay:()=>e.jsx(Q,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:ne}}})]})]}),e.jsx(Ne,{open:m.value,onClose:m.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",g.length," "]})," items?"]}),action:e.jsx(N,{variant:"contained",color:"error",onClick:()=>{$(),m.onFalse()},children:"Delete"})})]})}function tt({inputData:s,filters:f,dateError:m,dayError:D}){const{stock:j,publish:r,status:h,commodity:x,name:o,branch:d,startDate:g,endDate:p,startDay:v,endDay:w,category:C}=f;return j.length&&(s=s.filter(n=>j.includes(n.inventoryType))),m||g&&p&&(s=s.filter(n=>J(n.created_at,g,p))),D||v&&w&&(s=s.filter(n=>J(n.created_at,v,w))),r.length&&(s=s.filter(n=>r.includes(n.publish))),o&&(s=s.filter(n=>n.name.toLowerCase().indexOf(o.toLowerCase())!==-1)),h!=="all"&&(s=s.filter(n=>n.commodity===h)),x.length&&(s=s.filter(n=>x.includes(n.nccf_order_status))),C.length&&(s=s.filter(n=>C.includes(n.category))),d.length&&(s=s.filter(n=>d.includes(n.branch))),s}const re={publish:[],stock:[],commodity:[],status:"all",branch:[],category:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null},at={category:!1},st=["category","actions"];function lt({singleCode:s}){const{enqueueSnackbar:f}=xe(),m=ge(),D=be(),j=pe();K();const[r,h]=l.useState([]),[x,o]=l.useState(!1),[d,g]=l.useState(re),[p,v]=l.useState([]),[w,C]=l.useState(!1),[n,M]=l.useState({}),[fe,I]=l.useState(!1),[X,Z]=l.useState(at),[ee,O]=l.useState([]),[_,z]=l.useState("All"),[te,P]=l.useState([]),[S,k]=l.useState("All"),[B,ae]=l.useState([]),H=U(d.startDate,d.endDate),F=U(d.startDay,d.endDay);l.useState([]);const E=()=>{const t=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${_}/order`;y.get(t).then(c=>{var b;return h((b=c==null?void 0:c.data)==null?void 0:b.data)}).catch(c=>console.log(c))};l.useEffect(()=>{_==="All"?T():(se(),E())},[_]);const T=()=>{o(!0),z("All"),k("All"),y.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/order").then(t=>{var c;o(!1),h((c=t==null?void 0:t.data)==null?void 0:c.data)}).catch(t=>{o(!1),console.log(t)})};l.useEffect(()=>{y.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/state/branch").then(t=>{var L;const c=((L=t==null?void 0:t.data)==null?void 0:L.data)||[],b=[{branch_name:"All",csp_count:1},...c];O(b)}).catch(t=>console.log(t)),T()},[]);const A=nt({inputData:r,filters:d,dateError:H}),se=async()=>{if(_!=="All"){P([]);try{let c=(await y.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${_}/csp`)).data.data.map(L=>({name:L.name,csp_code:L.csp_code,order_count:L.order_count}));const b=[{name:"All",csp_code:"All",order_count:1},...c];P(b)}catch(t){console.error("Error fetching data:",t)}}},$=t=>{y.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${t}/orders`).then(c=>{var b;return h((b=c==null?void 0:c.data)==null?void 0:b.data)}).catch(c=>console.log(c))};l.useEffect(()=>{S==="All"?E():$(S)},[S]);const W=l.useCallback(t=>{ae(t.target.value),k(t.target.value)},[S]),le=l.useCallback(t=>{z(t.target.value),k("All")},[S]),ne=!je(re,d)||!!d.startDate&&!!d.endDate||!!d.startDay&&!!d.endDay,a=l.useCallback((t,c)=>{g(b=>({...b,[t]:c}))},[]),i=l.useCallback(()=>{g(re)},[]);l.useCallback(t=>{const c=r.filter(b=>b.id!==t);f("Delete success!"),h(c)},[f,r]);const u=[{label:"accepted",count:0},{label:"declined",count:0},{label:"placed",count:0}];u.forEach(t=>{t.count=A.filter(c=>c.nccf_order_status===t.label).length});const R=[{value:"all",label:"All"},{value:"Bharat Aata",label:"Bharat Aata"},{value:"Bharat Daal",label:"Bharat Daal"},{value:"Bharat Rice",label:"Bharat Rice"}],Ee=l.useCallback(()=>{const t=r.filter(c=>!p.includes(c.id));f("Delete success!"),h(t)},[f,p,r]);l.useCallback(t=>{},[D]);const me=[{field:"seq_number",headerName:"Sr No.",minWidth:100},{field:"name",headerName:"Name",width:250},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"branch",headerName:"Branch",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:t=>Pe(t.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:t=>e.jsx(G,{children:e.jsx(Y,{variant:"soft",color:t.row.nccf_order_status==="accepted"&&"success"||t.row.nccf_order_status==="placed"&&"warning"||t.row.nccf_order_status==="declined"&&"error"||"default",children:t.row.nccf_order_status==="accepted"?"Accepted":t.row.nccf_order_status==="declined"?"Declined":"Placed"})})},{field:"vendor1",headerName:"Action",flex:.5,minWidth:250,renderCell:t=>e.jsxs(e.Fragment,{children:[e.jsx(G,{sx:{px:0,marginRight:2},children:e.jsxs(N,{disabled:t.row.nccf_order_status==="accepted"||t.row.nccf_order_status==="declined",variant:"contained",onClick:()=>{M(t.row),I(!0),C(!0)},sx:{backgroundColor:"green",width:90},children:[e.jsx(Ye,{})," Approve"]})}),e.jsx(G,{sx:{px:0},children:e.jsxs(N,{disabled:t.row.nccf_order_status==="accepted"||t.row.nccf_order_status==="declined",onClick:()=>{M(t.row),I(!1),C(!0)},variant:"contained",sx:{backgroundColor:"red",width:80},children:[e.jsx(Qe,{})," Reject"]})})]})}],Me=["primary","error","warning","error"],Ie=l.useCallback((t,c)=>{a("status",c)},[a]),ze=()=>me.filter(t=>!st.includes(t.field)).map(t=>t.field);return e.jsx(e.Fragment,{children:x?e.jsx(Ge,{}):e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{maxWidth:j.themeStretch?!1:"xl",children:[e.jsx(V,{container:!0,spacing:3,children:u.map((t,c)=>e.jsx(V,{item:!0,xs:12,md:4,mb:5,children:e.jsx(_e,{title:ye(t==null?void 0:t.label),total:(t==null?void 0:t.count)==0?"0":t.count,color:Me[c],chart:{}})}))}),e.jsx(we,{heading:"Order List",links:[{name:"Dashboard",href:q.dashboard.root},{name:"Order",href:q.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),e.jsx(Ue,{getAllDocument:$,getOrder:T,getAllBranch:E,branch:_,currentUser:n,open:w,setOpen:C,approve:fe,cspCode:S}),e.jsxs(Se,{sx:{height:(A==null?void 0:A.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[e.jsx(De,{value:d.status,onChange:Ie,sx:{px:2.5,boxShadow:t=>`inset 0 -2px 0 0 ${ve(t.palette.grey[500],.08)}`},children:R.map(t=>e.jsx(Ae,{iconPosition:"end",value:t.value,label:t.label,icon:e.jsx(Y,{variant:(t.value==="all"||t.value===d.status)&&"filled"||"soft",color:t.value==="Bharat Aata"&&"success"||t.value==="Bharat Daal"&&"warning"||t.value==="Bharat Rice"&&"error"||"default",children:["Bharat Aata","Bharat Rice","Bharat Daal"].includes(t.value)?r.filter(c=>c.commodity===t.value).length:r.length})},t.value))}),e.jsx(Oe,{disableRowSelectionOnClick:!0,rows:A,columns:me,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:X,onColumnVisibilityModelChange:t=>Z(t),slots:{toolbar:()=>e.jsx(e.Fragment,{children:e.jsxs(Be,{children:[e.jsxs(oe,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(ie,{children:"Branch"}),e.jsx(de,{value:_,onChange:le,input:e.jsx(he,{label:"Branch"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:ee.map(t=>e.jsx(ue,{value:t.branch_name,disabled:t.csp_count==0,children:t.branch_name},t.branch_name))})]}),_!=="All"&&e.jsxs(oe,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(ie,{children:"CSP"}),e.jsx(de,{value:S,onChange:W,input:e.jsx(he,{label:"CSP"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:te.map(t=>e.jsx(ue,{value:t.csp_code,disabled:t.order_count==0,children:t.name},t.csp_code))})]}),ne&&e.jsx(Ve,{filters:d,onFilters:a,onResetFilters:i,results:A.length,sx:{p:2.5,pt:0}}),e.jsxs(Re,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!p.length&&e.jsxs(N,{size:"small",color:"error",startIcon:e.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:m.onTrue,children:["Delete (",p.length,")"]}),e.jsx(Fe,{}),e.jsx(Te,{})]}),e.jsx(qe,{filters:d,onFilters:a,roleOptions:Le,branchOptions:["hello"],dateError:H,dayError:F})]})}),noRowsOverlay:()=>e.jsx(Q,{title:"No Data"}),noResultsOverlay:()=>e.jsx(Q,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:ze}}})]})]}),e.jsx(Ne,{open:m.value,onClose:m.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",p.length," "]})," items?"]}),action:e.jsx(N,{variant:"contained",color:"error",onClick:()=>{Ee(),m.onFalse()},children:"Delete"})})]})})}function nt({inputData:s,filters:f,dateError:m,dayError:D}){const{stock:j,publish:r,status:h,commodity:x,name:o,branch:d,startDate:g,endDate:p,startDay:v,endDay:w,category:C}=f;return j.length&&(s=s.filter(n=>j.includes(n.inventoryType))),m||g&&p&&(s=s.filter(n=>J(n.created_at,g,p))),D||v&&w&&(s=s.filter(n=>J(n.created_at,v,w))),r.length&&(s=s.filter(n=>r.includes(n.publish))),o&&(s=s.filter(n=>n.name.toLowerCase().indexOf(o.toLowerCase())!==-1)),C.length&&(s=s.filter(n=>C.includes(n.category))),h!=="all"&&(s=s.filter(n=>n.commodity===h)),x.length&&(s=s.filter(n=>x.includes(n.nccf_order_status))),d.length&&(s=s.filter(n=>d.includes(n.branch))),s}function ct(s){const[f,m]=l.useState([]),[D,j]=l.useState(0),{vendor:r}=K();l.useEffect(()=>{h()},[]);function h(){y.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${r==null?void 0:r.csp_code}/orders`).then(o=>{m(o.data.data)})}function x(){j(o=>o+1)}return e.jsx(e.Fragment,{children:e.jsx(Ke,{tableData:f,fetchAllOrdersDemo:x})})}function it(){const{vendor:s}=K();return e.jsxs(e.Fragment,{children:[e.jsx(Je,{children:e.jsx("title",{children:" Dashboard: Order List"})}),(s==null?void 0:s.category)==="branch"?e.jsx(et,{}):(s==null?void 0:s.category)==="head_office"?e.jsx(lt,{}):e.jsx(ct,{})]})}export{it as default};
