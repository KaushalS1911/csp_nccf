import{r as i,u as _,K as R,f as se,j as e,bs as oe,cP as E,bt as re,F as ae,bu as ne,N as le,g as ce,bv as ie,D as k,M as D,cn as de,aF as z,a as ue,c as he,cQ as me,cR as pe,aJ as ge,C as N,cu as xe,R as fe,i as L,q as F,cS as be,cT as ye,cU as je,cV as Ce,bQ as we,cW as Se,c9 as Te,h as Re,bR as Pe,bS as ve,bT as Oe,bU as ke,cX as _e,cY as Fe,cZ as Ae,c_ as Be,c$ as Ee,d0 as De,d1 as We,a8 as m,ah as T,d2 as O,a2 as q,d3 as v,B as G,T as W,S as He,ai as Le,d4 as M,d5 as J,bK as Q,ay as Ie,br as ze,d6 as Ne,bd as qe,bw as Me,cd as Ue,d7 as U,d8 as $e,H as Ve,d9 as Ge}from"./index-ePOSdPGB.js";function Je({editDialogOpen:o,setEditDialogOpen:u,editData:a,dataFiltered:n,fetchAllOrdersDemo:y}){const[g,t]=i.useState([]),{vendor:x}=_();i.useState({}),i.useEffect(()=>{s()},[]);function s(){R.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(w=>{var p;t((p=w.data)==null?void 0:p.data)})}const d=se({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:l,handleSubmit:f,formState:{isSubmitting:j}}=d;i.useEffect(()=>{a&&l({csp_code:a==null?void 0:a.csp_code,commodity:a==null?void 0:a.commodity,quantity:a==null?void 0:a.quantity})},[a]);const c=async w=>{u(!1);const p={...w,csp_code:x.csp_code,mode:"test",status:"0"};try{const S=await R.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",p);S.data.status=="201"?(D("Order added successfully!"),y()):S.data.status=="400"&&D("Failed to add order.",{variant:"error"})}catch(S){console.error("Order creation error:",S),D("Order creation failed.",{variant:"error"})}};return e.jsx(oe,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>u(!1),children:e.jsxs(E,{sx:{py:5,px:3},children:[e.jsx(re,{children:"Edit Order"}),e.jsxs(ae,{methods:d,children:[e.jsxs(ne,{maxWidth:"lg ",children:[e.jsx(E,{mb:2,mt:1,children:e.jsx(le,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:g.map(w=>w==null?void 0:w.commodity_name),getOptionLabel:w=>w})}),e.jsx(E,{mt:2,children:e.jsx(ce,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(ie,{children:[e.jsx(k,{onClick:()=>u(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(k,{variant:"contained",onClick:f(c),children:"Save"})]})]})]})})}const Qe=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],H={name:"",commodity:[],order_status:[],status:"all"};function Ke({tableData:o,fetchAllOrdersDemo:u}){const{enqueueSnackbar:a}=de(),n=z(),y=ue(),g=he(),t=me(),[x,s]=i.useState(!1),[d,l]=i.useState(0),[f,j]=i.useState(H),[c,w]=i.useState({}),p=Ye({inputData:o,comparator:pe(t.order,t.orderBy),filters:f}),S=p.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),A=t.dense?56:76,r=!ge(H,f),b=!p.length&&r||!p.length,P=i.useCallback((h,C)=>{t.onResetPage(),j(B=>({...B,[h]:C}))},[t]),X=i.useCallback(()=>{j(H)},[]),Z=i.useCallback(h=>{const C=o.filter(B=>B.id!==h);a("Delete success!"),setTableData(C),t.onUpdatePageDeleteRow(S.length)},[S.length,a,t,o]),ee=i.useCallback(()=>{const h=o.filter(C=>!t.selected.includes(C.id));a("Delete success!"),setTableData(h),t.onUpdatePageDeleteRows({totalRowsInPage:S.length,totalRowsFiltered:p.length})},[p.length,S.length,a,t,o]),te=i.useCallback(h=>{l(h==null?void 0:h.id),w(h)},[y]);return i.useCallback((h,C)=>{P("status",C)},[P]),i.useCallback(h=>{setTableData(C=>[...C,h])},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{maxWidth:n.themeStretch?!1:"xxl",children:[e.jsx(xe,{heading:"Orders",links:[{name:""}],action:e.jsx(k,{component:fe,variant:"contained",startIcon:e.jsx(L,{icon:"mingcute:add-line"}),onClick:()=>{s(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(F,{children:[e.jsx(be,{filters:f,onFilters:P,commodityOptions:ye,orderStatusOptions:je}),r&&e.jsx(Ce,{filters:f,onFilters:P,onResetFilters:X,results:p.length,sx:{p:2.5,pt:0}}),e.jsxs(we,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Se,{dense:!0,numSelected:t.selected.length,rowCount:p.length,onSelectAllRows:h=>t.onSelectAllRows(h,p.map(C=>C.id)),action:e.jsx(Te,{title:"Delete",children:e.jsx(Re,{color:"primary",onClick:g.onTrue,children:e.jsx(L,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(Pe,{children:e.jsxs(ve,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Oe,{order:t.order,orderBy:t.orderBy,headLabel:Qe,rowCount:p.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:h=>t.onSelectAllRows(h,p.map(C=>C.id))}),e.jsxs(ke,{children:[p.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((h,C)=>e.jsx(_e,{row:{...h,index:C},selected:t.selected.includes(h.id),onSelectRow:()=>t.onSelectRow(h.id),onDeleteRow:()=>Z(h.id),onEditRow:()=>te(h)},h.id)),e.jsx(Fe,{height:A,emptyRows:Ae(t.page,t.rowsPerPage,o.length)}),e.jsx(Be,{isNotFound:b})]})]})}),e.jsx(Ee,{count:p.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(De,{open:g.value,onClose:g.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(k,{variant:"contained",color:"error",onClick:()=>{ee(),g.onFalse()},children:"Delete"})}),e.jsx(We,{dialogOpen:x,setDialogOpen:s,editId:c,fetchAllOrdersDemo:u}),e.jsx(Je,{editDialogOpen:d,setEditDialogOpen:l,editData:c,dataFiltered:p,fetchAllOrdersDemo:u})]})}function Ye({inputData:o,comparator:u,filters:a}){const{name:n,status:y,commodity:g,order_status:t}=a,x=o.map((s,d)=>[s,d]);return x.sort((s,d)=>{const l=u(s[0],d[0]);return l!==0?l:s[1]-d[1]}),o=x.map(s=>s[0]),n&&(o=o.filter(s=>s.commodity.toLowerCase().includes(n.toLowerCase()))),y!=="all"&&(o=o.filter(s=>s.status===y)),g.length&&(o=o.filter(s=>g.includes(s.commodity))),t.length&&(o=o.filter(s=>t.includes(s.nccf_order_status))),o}m.string,m.array,m.array,m.string;m.object;function Xe({vendorCode:o}){const{vendor:u}=_(),a=z(),[n,y]=i.useState({}),[g,t]=i.useState([]),[x,s]=i.useState(0);i.useEffect(()=>{u.csp_code&&(f(),l())},[x]);function d(){s(j=>j+1)}function l(){R.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${u.csp_code}/orders_stats`).then(j=>{var c;y((c=j.data)==null?void 0:c.data[0])})}function f(){R.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${u.csp_code}/orders`).then(j=>{var c;t((c=j.data)==null?void 0:c.data)})}return e.jsx(N,{maxWidth:a.themeStretch?!1:"xl",children:e.jsxs(T,{container:!0,spacing:3,children:[e.jsx(T,{xs:12,md:3,children:e.jsx(O,{title:"Total Orders",total:(n==null?void 0:n.total_orders)||"0"})}),e.jsx(T,{xs:12,md:3,children:e.jsx(O,{title:"Orders Pending",total:(n==null?void 0:n.placed_orders)||"0"})}),e.jsx(T,{xs:12,md:3,children:e.jsx(O,{title:"Orders Accepted",total:(n==null?void 0:n.accepted_orders)||"0"})}),e.jsx(T,{xs:12,md:3,children:e.jsx(O,{title:"Orders Declined",total:(n==null?void 0:n.declined_orders)||"0"})}),e.jsx(T,{xs:12,lg:12,children:e.jsx(Ke,{tableData:g,fetchAllOrdersDemo:d})})]})})}function I({title:o,percent:u,total:a,chart:n,sx:y,...g}){const t=q(),{colors:x=[t.palette.primary.light,t.palette.primary.main],series:s,options:d}=n,l={colors:x.map(f=>f[1]),fill:{type:"gradient",gradient:{colorStops:[{offset:0,color:x[0],opacity:1},{offset:100,color:x[1],opacity:1}]}},chart:{sparkline:{enabled:!0}},plotOptions:{bar:{columnWidth:"68%",borderRadius:2}},tooltip:{x:{show:!1},y:{formatter:f=>v(f),title:{formatter:()=>""}},marker:{show:!1}},...d};return e.jsxs(F,{sx:{display:"flex",alignItems:"center",p:3,...y},...g,children:[e.jsxs(G,{sx:{flexGrow:1},children:[e.jsx(W,{variant:"subtitle2",children:o}),e.jsx(He,{direction:"row",alignItems:"center",sx:{mt:2,mb:1},children:e.jsxs(W,{component:"div",variant:"subtitle2",children:[u>0&&"+",Le(u)]})}),e.jsx(W,{variant:"h3",children:v(a)})]}),e.jsx(M,{dir:"ltr",type:"bar",series:[{data:s}],options:l,width:60,height:36})]})}I.propTypes={chart:m.object,percent:m.number,sx:m.object,title:m.string,total:m.number};const $=400,V=72,Ze=Ie(M)(({theme:o})=>({height:$,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:V,borderTop:`dashed 1px ${o.palette.divider}`,top:`calc(${$-V}px) !important`}}));function K({title:o,subheader:u,chart:a,...n}){const y=q(),{colors:g,series:t,options:x}=a,s=t.map(l=>l.value),d=J({chart:{sparkline:{enabled:!0}},colors:g,labels:t.map(l=>l.label),stroke:{colors:[y.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:l=>v(l),title:{formatter:l=>`${l}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:l=>v(l)},total:{formatter:l=>{const f=l.globals.seriesTotals.reduce((j,c)=>j+c,0);return v(f)}}}}}},...x});return e.jsxs(F,{...n,children:[e.jsx(Q,{title:o,subheader:u,sx:{mb:5}}),e.jsx(Ze,{dir:"ltr",type:"donut",series:s,options:d,width:"100%",height:280})]})}K.propTypes={chart:m.object,subheader:m.string,title:m.string};function Y({title:o,subheader:u,chart:a,...n}){const{labels:y,colors:g,series:t,options:x}=a,s=ze(),[d,l]=i.useState("Week"),f=J({chart:{stacked:!0},colors:g,stroke:{width:0},xaxis:{categories:d==="Week"&&y.week||d==="Month"&&y.month||y.year},tooltip:{y:{formatter:c=>Ne(c)}},plotOptions:{bar:{borderRadius:d==="Week"&&8||d==="Month"&&6||10,columnWidth:"20%"}},...x}),j=i.useCallback(c=>{s.onClose(),l(c)},[s]);return e.jsxs(e.Fragment,{children:[e.jsxs(F,{...n,children:[e.jsx(Q,{title:o,subheader:u,action:e.jsxs(qe,{onClick:s.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[d,e.jsx(L,{width:16,icon:s.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),t.map(c=>e.jsx(G,{sx:{mt:3,mx:3},children:c.type===d&&e.jsx(M,{dir:"ltr",type:"bar",series:c.data,options:f,width:"100%",height:375})},c.type))]}),e.jsx(Me,{open:s.open,onClose:s.onClose,sx:{width:140},children:t.map(c=>e.jsx(Ue,{selected:c.type===d,onClick:()=>j(c.type),children:c.type},c.type))})]})}Y.propTypes={chart:m.object,subheader:m.string,title:m.string};m.bool,m.string,m.func,m.func,m.string,m.object,m.string;function et({vendorCode:o}){const{vendor:u}=_(),a=z(),n=q(),[y,g]=i.useState([]),[t,x]=i.useState([]),[s,d]=i.useState([]),[l,f]=i.useState([]),j={week:["Mon","Tue","Web","Thu","Fri","Sat","Sun"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:["2018","2019","2020","2021","2022"]};i.useEffect(()=>{u.csp_code&&p(),c(),w()},[]),i.useEffect(()=>{const r=t==null?void 0:t.map((b,P)=>(b==null?void 0:b.category)!=="Distributor"?{label:U(b==null?void 0:b.category),value:b==null?void 0:b.count}:null).filter(b=>b!==null);f(r)},[t]);function c(){R.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(r=>{x(r.data.data)})}function w(){R.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(r=>{d(r.data.data)})}function p(){R.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${u.csp_code}/orders`).then(r=>{var b;g((b=r.data)==null?void 0:b.data)})}const S=["placed","accepted","declined"],A=s.filter(r=>S.includes(r.nccf_order_status));return e.jsx(N,{maxWidth:a.themeStretch?!1:"xl",children:e.jsxs(T,{container:!0,spacing:3,children:[t&&t.map((r,b)=>(r==null?void 0:r.category)!=="Distributor"&&e.jsx(T,{xs:12,md:3,children:e.jsx(I,{title:U(r==null?void 0:r.category),total:r==null?void 0:r.count,chart:{}})})),s&&A.map((r,b)=>(r==null?void 0:r.category)!=="Distributor"&&e.jsx(T,{xs:12,md:4,children:e.jsx(I,{title:$e(r==null?void 0:r.nccf_order_status),total:r==null?void 0:r["COUNT(id)"],chart:{}})})),e.jsx(T,{xs:12,md:6,lg:4,children:l!==[]&&e.jsx(K,{title:"CSP distribution",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:l}})}),e.jsx(T,{xs:12,md:6,lg:8,children:e.jsx(Y,{title:"Orders",chart:{labels:j,colors:[n.palette.primary.main,n.palette.error.main,n.palette.warning.main],series:[{type:"Week",data:[{name:"Bharat Daal",data:[20,34,48,65,37,48,9]},{name:"Bharat Aata",data:[10,34,13,26,27,28,18]},{name:"Bharat Rice",data:[10,14,13,16,17,18,28]}]},{type:"Month",data:[{name:"Bharat Daal",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Aata",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Rice",data:[10,34,13,56,77,88,99,77,45,12,43,34]}]},{type:"Year",data:[{name:"Bharat Daal",data:[10,34,13,56,77]},{name:"Bharat Aata",data:[10,34,13,56,77]},{name:"Bharat Rice",data:[10,34,13,56,77]}]}]}})})]})})}function st(){const{vendor:o}=_(),u=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),u==="other-login"?e.jsx(Xe,{}):(o==null?void 0:o.category)==="branch"?e.jsx(Ge,{}):e.jsx(et,{})]})}export{st as default};
