import{r as i,u as v,K as S,f as oe,j as e,bs as re,cP as F,bt as ae,F as ne,bu as le,N as ce,g as ie,bv as de,D as O,M as A,cn as ue,aF as D,a as he,c as me,cQ as pe,cR as ge,aJ as xe,C as H,cu as fe,R as be,i as E,q as k,cS as ye,cT as je,cU as Ce,cV as we,bQ as Se,cW as Te,c9 as Re,h as Pe,bR as Oe,bS as ve,bT as ke,bU as _e,cX as Fe,cY as Ae,cZ as Be,c_ as Ee,c$ as We,d0 as De,d1 as He,a8 as m,ah as w,d2 as P,a2 as L,d3 as T,B as G,T as U,d4 as I,d5 as J,bK as Q,ay as Le,br as Ie,d6 as ze,bd as Ne,bw as Ue,cd as qe,d7 as q,d8 as M,H as Me,d9 as $e}from"./index-1vZKvBC1.js";function Ve({editDialogOpen:o,setEditDialogOpen:p,editData:a,dataFiltered:n,fetchAllOrdersDemo:f}){const[g,t]=i.useState([]),{vendor:x}=v();i.useState({}),i.useEffect(()=>{r()},[]);function r(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(C=>{var s;t((s=C.data)==null?void 0:s.data)})}const d=oe({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:c,handleSubmit:b,formState:{isSubmitting:y}}=d;i.useEffect(()=>{a&&c({csp_code:a==null?void 0:a.csp_code,commodity:a==null?void 0:a.commodity,quantity:a==null?void 0:a.quantity})},[a]);const l=async C=>{p(!1);const s={...C,csp_code:x.csp_code,mode:"test",status:"0"};try{const h=await S.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",s);h.data.status=="201"?(A("Order added successfully!"),f()):h.data.status=="400"&&A("Failed to add order.",{variant:"error"})}catch(h){console.error("Order creation error:",h),A("Order creation failed.",{variant:"error"})}};return e.jsx(re,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>p(!1),children:e.jsxs(F,{sx:{py:5,px:3},children:[e.jsx(ae,{children:"Edit Order"}),e.jsxs(ne,{methods:d,children:[e.jsxs(le,{maxWidth:"lg ",children:[e.jsx(F,{mb:2,mt:1,children:e.jsx(ce,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:g.map(C=>C==null?void 0:C.commodity_name),getOptionLabel:C=>C})}),e.jsx(F,{mt:2,children:e.jsx(ie,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(de,{children:[e.jsx(O,{onClick:()=>p(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(O,{variant:"contained",onClick:b(l),children:"Save"})]})]})]})})}const Ge=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],B={name:"",commodity:[],order_status:[],status:"all"};function Je({tableData:o,fetchAllOrdersDemo:p}){const{enqueueSnackbar:a}=ue(),n=D(),f=he(),g=me(),t=pe(),[x,r]=i.useState(!1),[d,c]=i.useState(0),[b,y]=i.useState(B),[l,C]=i.useState({}),s=Qe({inputData:o,comparator:ge(t.order,t.orderBy),filters:b}),h=s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),z=t.dense?56:76,N=!xe(B,b),X=!s.length&&N||!s.length,R=i.useCallback((u,j)=>{t.onResetPage(),y(_=>({..._,[u]:j}))},[t]),Z=i.useCallback(()=>{y(B)},[]),ee=i.useCallback(u=>{const j=o.filter(_=>_.id!==u);a("Delete success!"),setTableData(j),t.onUpdatePageDeleteRow(h.length)},[h.length,a,t,o]),te=i.useCallback(()=>{const u=o.filter(j=>!t.selected.includes(j.id));a("Delete success!"),setTableData(u),t.onUpdatePageDeleteRows({totalRowsInPage:h.length,totalRowsFiltered:s.length})},[s.length,h.length,a,t,o]),se=i.useCallback(u=>{c(u==null?void 0:u.id),C(u)},[f]);return i.useCallback((u,j)=>{R("status",j)},[R]),i.useCallback(u=>{setTableData(j=>[...j,u])},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{maxWidth:n.themeStretch?!1:"xxl",children:[e.jsx(fe,{heading:"Orders",links:[{name:""}],action:e.jsx(O,{component:be,variant:"contained",startIcon:e.jsx(E,{icon:"mingcute:add-line"}),onClick:()=>{r(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(k,{children:[e.jsx(ye,{filters:b,onFilters:R,commodityOptions:je,orderStatusOptions:Ce}),N&&e.jsx(we,{filters:b,onFilters:R,onResetFilters:Z,results:s.length,sx:{p:2.5,pt:0}}),e.jsxs(Se,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Te,{dense:!0,numSelected:t.selected.length,rowCount:s.length,onSelectAllRows:u=>t.onSelectAllRows(u,s.map(j=>j.id)),action:e.jsx(Re,{title:"Delete",children:e.jsx(Pe,{color:"primary",onClick:g.onTrue,children:e.jsx(E,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(Oe,{children:e.jsxs(ve,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ke,{order:t.order,orderBy:t.orderBy,headLabel:Ge,rowCount:s.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:u=>t.onSelectAllRows(u,s.map(j=>j.id))}),e.jsxs(_e,{children:[s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((u,j)=>e.jsx(Fe,{row:{...u,index:j},selected:t.selected.includes(u.id),onSelectRow:()=>t.onSelectRow(u.id),onDeleteRow:()=>ee(u.id),onEditRow:()=>se(u)},u.id)),e.jsx(Ae,{height:z,emptyRows:Be(t.page,t.rowsPerPage,o.length)}),e.jsx(Ee,{isNotFound:X})]})]})}),e.jsx(We,{count:s.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(De,{open:g.value,onClose:g.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(O,{variant:"contained",color:"error",onClick:()=>{te(),g.onFalse()},children:"Delete"})}),e.jsx(He,{dialogOpen:x,setDialogOpen:r,editId:l,fetchAllOrdersDemo:p}),e.jsx(Ve,{editDialogOpen:d,setEditDialogOpen:c,editData:l,dataFiltered:s,fetchAllOrdersDemo:p})]})}function Qe({inputData:o,comparator:p,filters:a}){const{name:n,status:f,commodity:g,order_status:t}=a,x=o.map((r,d)=>[r,d]);return x.sort((r,d)=>{const c=p(r[0],d[0]);return c!==0?c:r[1]-d[1]}),o=x.map(r=>r[0]),n&&(o=o.filter(r=>r.commodity.toLowerCase().includes(n.toLowerCase()))),f!=="all"&&(o=o.filter(r=>r.status===f)),g.length&&(o=o.filter(r=>g.includes(r.commodity))),t.length&&(o=o.filter(r=>t.includes(r.nccf_order_status))),o}m.string,m.array,m.array,m.string;m.object;function Ke({vendorCode:o}){const{vendor:p}=v(),a=D(),[n,f]=i.useState({}),[g,t]=i.useState([]),[x,r]=i.useState(0);i.useEffect(()=>{p.csp_code&&(b(),c())},[x]);function d(){r(y=>y+1)}function c(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${p.csp_code}/orders_stats`).then(y=>{var l;f((l=y.data)==null?void 0:l.data[0])})}function b(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${p.csp_code}/orders`).then(y=>{var l;t((l=y.data)==null?void 0:l.data)})}return e.jsx(H,{maxWidth:a.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Total Orders",total:(n==null?void 0:n.total_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Pending",total:(n==null?void 0:n.placed_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Accepted",total:(n==null?void 0:n.accepted_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Declined",total:(n==null?void 0:n.declined_orders)||"0"})}),e.jsx(w,{xs:12,lg:12,children:e.jsx(Je,{tableData:g,fetchAllOrdersDemo:d})})]})})}function W({title:o,percent:p,total:a,chart:n,sx:f,...g}){const t=L(),{colors:x=[t.palette.primary.light,t.palette.primary.main],series:r,options:d}=n,c={colors:x.map(b=>b[1]),fill:{type:"gradient",gradient:{colorStops:[{offset:0,color:x[0],opacity:1},{offset:100,color:x[1],opacity:1}]}},chart:{sparkline:{enabled:!0}},plotOptions:{bar:{columnWidth:"68%",borderRadius:2}},tooltip:{x:{show:!1},y:{formatter:b=>T(b),title:{formatter:()=>""}},marker:{show:!1}},...d};return e.jsxs(k,{sx:{display:"flex",alignItems:"center",p:3,...f},...g,children:[e.jsxs(G,{sx:{flexGrow:1,mt:1,mb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(U,{variant:"subtitle2",children:o}),e.jsx(U,{sx:{fontSize:"38px",fontWeight:700},children:T(a)})]}),e.jsx(I,{dir:"ltr",type:"bar",series:[{data:r}],options:c,width:60,height:36})]})}W.propTypes={chart:m.object,percent:m.number,sx:m.object,title:m.string,total:m.number};const $=400,V=72,Ye=Le(I)(({theme:o})=>({height:$,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:V,borderTop:`dashed 1px ${o.palette.divider}`,top:`calc(${$-V}px) !important`}}));function K({title:o,subheader:p,chart:a,...n}){const f=L(),{colors:g,series:t,options:x}=a,r=t.map(c=>c.value),d=J({chart:{sparkline:{enabled:!0}},colors:g,labels:t.map(c=>c.label),stroke:{colors:[f.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:c=>T(c),title:{formatter:c=>`${c}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:c=>T(c)},total:{formatter:c=>{const b=c.globals.seriesTotals.reduce((y,l)=>y+l,0);return T(b)}}}}}},...x});return e.jsxs(k,{...n,children:[e.jsx(Q,{title:o,subheader:p,sx:{mb:5}}),e.jsx(Ye,{dir:"ltr",type:"donut",series:r,options:d,width:"100%",height:280})]})}K.propTypes={chart:m.object,subheader:m.string,title:m.string};function Y({title:o,subheader:p,chart:a,...n}){const{labels:f,colors:g,series:t,options:x}=a,r=Ie(),[d,c]=i.useState("Week"),b=J({chart:{stacked:!0},colors:g,stroke:{width:0},xaxis:{categories:d==="Week"&&f.week||d==="Month"&&f.month||f.year},tooltip:{y:{formatter:l=>ze(l)}},plotOptions:{bar:{borderRadius:d==="Week"&&8||d==="Month"&&6||10,columnWidth:"20%"}},...x}),y=i.useCallback(l=>{r.onClose(),c(l)},[r]);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{...n,children:[e.jsx(Q,{title:o,subheader:p,action:e.jsxs(Ne,{onClick:r.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[d,e.jsx(E,{width:16,icon:r.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),t.map(l=>e.jsx(G,{sx:{mt:3,mx:3},children:l.type===d&&e.jsx(I,{dir:"ltr",type:"bar",series:l.data,options:b,width:"100%",height:375})},l.type))]}),e.jsx(Ue,{open:r.open,onClose:r.onClose,sx:{width:140},children:t.map(l=>e.jsx(qe,{selected:l.type===d,onClick:()=>y(l.type),children:l.type},l.type))})]})}Y.propTypes={chart:m.object,subheader:m.string,title:m.string};m.bool,m.string,m.func,m.func,m.string,m.object,m.string;function Xe({vendorCode:o}){v();const p=D(),a=L();i.useState([]);const[n,f]=i.useState([]),[g,t]=i.useState([]),[x,r]=i.useState([]),d={week:["Mon","Tue","Web","Thu","Fri","Sat","Sun"],month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],year:["2018","2019","2020","2021","2022"]};i.useEffect(()=>{c(),b()},[]),i.useEffect(()=>{const s=n==null?void 0:n.map((h,z)=>(h==null?void 0:h.category)!=="Distributor"?{label:q(h==null?void 0:h.category),value:h==null?void 0:h.count}:null).filter(h=>h!==null);r(s)},[n]);function c(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(s=>{f(s.data.data)})}function b(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(s=>{t(s.data.data)})}const y=["placed","accepted","declined"],l=g.filter(s=>y.includes(s.nccf_order_status)),C=[];return l.map(s=>C.push({label:M(s==null?void 0:s.nccf_order_status),value:(s==null?void 0:s["COUNT(id)"])||0})),e.jsx(H,{maxWidth:p.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[n&&n.map((s,h)=>e.jsx(w,{xs:12,md:3,children:e.jsx(W,{title:q(s==null?void 0:s.category),total:(s==null?void 0:s.count)||0,chart:{}})})),g&&l.map((s,h)=>e.jsx(w,{xs:12,md:4,children:e.jsx(W,{title:M(s==null?void 0:s.nccf_order_status),total:(s==null?void 0:s["COUNT(id)"])||0,chart:{}})})),e.jsx(w,{xs:12,md:6,lg:4,children:x!==[]&&e.jsx(K,{title:"CSP distribution",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:x}})}),e.jsx(w,{xs:12,md:6,lg:8,children:e.jsx(Y,{title:"Orders",chart:{labels:d,colors:[a.palette.primary.main,a.palette.error.main,a.palette.warning.main],series:[{type:"Week",data:[{name:"Bharat Daal",data:[20,34,48,65,37,48,9]},{name:"Bharat Aata",data:[10,34,13,26,27,28,18]},{name:"Bharat Rice",data:[10,14,13,16,17,18,28]}]},{type:"Month",data:[{name:"Bharat Daal",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Aata",data:[10,34,13,56,77,88,99,77,45,12,43,34]},{name:"Bharat Rice",data:[10,34,13,56,77,88,99,77,45,12,43,34]}]},{type:"Year",data:[{name:"Bharat Daal",data:[10,34,13,56,77]},{name:"Bharat Aata",data:[10,34,13,56,77]},{name:"Bharat Rice",data:[10,34,13,56,77]}]}]}})})]})})}function et(){const{vendor:o}=v(),p=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),p==="other-login"?e.jsx(Ke,{}):(o==null?void 0:o.category)==="branch"?e.jsx($e,{}):e.jsx(Xe,{})]})}export{et as default};
