import{r as c,u as _,K as S,f as M,j as e,bs as X,cP as F,bt as Z,F as ee,bu as te,N as se,g as oe,bv as re,D as R,M as v,cn as ne,aF as B,a as le,c as ce,cQ as ae,cR as ie,aJ as de,C as H,cu as ue,R as he,i as D,q as V,cS as me,cT as ge,cU as pe,cV as xe,bQ as fe,cW as be,c9 as je,h as Ce,bR as ye,bS as we,bT as Se,bU as Te,cX as Pe,cY as Re,cZ as _e,c_ as Oe,c$ as Fe,d0 as ve,d1 as Ae,a8 as d,ah as w,d2 as P,a2 as $,d3 as Ee,d4 as A,bK as ke,ay as Be,d5 as He,d6 as z,d7 as N,d8 as U,H as Le,d9 as We}from"./index-Xy6jxm6p.js";function De({editDialogOpen:o,setEditDialogOpen:h,editData:r,dataFiltered:u,fetchAllOrdersDemo:b}){const[m,t]=c.useState([]),{vendor:C}=_();c.useState({}),c.useEffect(()=>{n()},[]);function n(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/commodity").then(f=>{var s;t((s=f.data)==null?void 0:s.data)})}const g=M({defaultValues:{csp_code:"",commodity:"",quantity:""}}),{reset:i,handleSubmit:y,formState:{isSubmitting:j}}=g;c.useEffect(()=>{r&&i({csp_code:r==null?void 0:r.csp_code,commodity:r==null?void 0:r.commodity,quantity:r==null?void 0:r.quantity})},[r]);const p=async f=>{h(!1);const s={...f,csp_code:C.csp_code,mode:"test",status:"0"};try{const l=await S.post("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/create_order",s);l.data.status=="201"?(v("Order added successfully!"),b()):l.data.status=="400"&&v("Failed to add order.",{variant:"error"})}catch(l){console.error("Order creation error:",l),v("Order creation failed.",{variant:"error"})}};return e.jsx(X,{open:o,fullWidth:!0,maxWidth:"md",onClose:()=>h(!1),children:e.jsxs(F,{sx:{py:5,px:3},children:[e.jsx(Z,{children:"Edit Order"}),e.jsxs(ee,{methods:g,children:[e.jsxs(te,{maxWidth:"lg ",children:[e.jsx(F,{mb:2,mt:1,children:e.jsx(se,{name:"commodity",type:"commodity",label:"Commodity",placeholder:"Choose Commodity",fullWidth:!0,options:m.map(f=>f==null?void 0:f.commodity_name),getOptionLabel:f=>f})}),e.jsx(F,{mt:2,children:e.jsx(oe,{name:"quantity",label:"Quantity",fullWidth:!0})})]}),e.jsxs(re,{children:[e.jsx(R,{onClick:()=>h(!1),variant:"outlined",color:"inherit",children:"Cancel"}),e.jsx(R,{variant:"contained",onClick:y(p),children:"Save"})]})]})]})})}const ze=[{id:"srNo",label:"Sr No",width:100},{id:"commodity",label:"Commodity",width:200},{id:"quantity",label:"Quantity",width:200},{id:"created_at",label:"Date",width:180},{id:"status",label:"Status",width:100},{id:"",width:88}],E={name:"",commodity:[],order_status:[],status:"all"};function Ne({tableData:o,fetchAllOrdersDemo:h}){const{enqueueSnackbar:r}=ne(),u=B(),b=le(),m=ce(),t=ae(),[C,n]=c.useState(!1),[g,i]=c.useState(0),[y,j]=c.useState(E),[p,f]=c.useState({}),s=Ue({inputData:o,comparator:ie(t.order,t.orderBy),filters:y}),l=s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),L=t.dense?56:76,W=!de(E,y),G=!s.length&&W||!s.length,T=c.useCallback((a,x)=>{t.onResetPage(),j(O=>({...O,[a]:x}))},[t]),Q=c.useCallback(()=>{j(E)},[]),K=c.useCallback(a=>{const x=o.filter(O=>O.id!==a);r("Delete success!"),setTableData(x),t.onUpdatePageDeleteRow(l.length)},[l.length,r,t,o]),Y=c.useCallback(()=>{const a=o.filter(x=>!t.selected.includes(x.id));r("Delete success!"),setTableData(a),t.onUpdatePageDeleteRows({totalRowsInPage:l.length,totalRowsFiltered:s.length})},[s.length,l.length,r,t,o]),J=c.useCallback(a=>{i(a==null?void 0:a.id),f(a)},[b]);return c.useCallback((a,x)=>{T("status",x)},[T]),c.useCallback(a=>{setTableData(x=>[...x,a])},[r]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{maxWidth:u.themeStretch?!1:"xxl",children:[e.jsx(ue,{heading:"Orders",links:[{name:""}],action:e.jsx(R,{component:he,variant:"contained",startIcon:e.jsx(D,{icon:"mingcute:add-line"}),onClick:()=>{n(!0)},children:"Add Order"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(V,{children:[e.jsx(me,{filters:y,onFilters:T,commodityOptions:ge,orderStatusOptions:pe}),W&&e.jsx(xe,{filters:y,onFilters:T,onResetFilters:Q,results:s.length,sx:{p:2.5,pt:0}}),e.jsxs(fe,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(be,{dense:!0,numSelected:t.selected.length,rowCount:s.length,onSelectAllRows:a=>t.onSelectAllRows(a,s.map(x=>x.id)),action:e.jsx(je,{title:"Delete",children:e.jsx(Ce,{color:"primary",onClick:m.onTrue,children:e.jsx(D,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ye,{children:e.jsxs(we,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Se,{order:t.order,orderBy:t.orderBy,headLabel:ze,rowCount:s.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:a=>t.onSelectAllRows(a,s.map(x=>x.id))}),e.jsxs(Te,{children:[s.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map((a,x)=>e.jsx(Pe,{row:{...a,index:x},selected:t.selected.includes(a.id),onSelectRow:()=>t.onSelectRow(a.id),onDeleteRow:()=>K(a.id),onEditRow:()=>J(a)},a.id)),e.jsx(Re,{height:L,emptyRows:_e(t.page,t.rowsPerPage,o.length)}),e.jsx(Oe,{isNotFound:G})]})]})}),e.jsx(Fe,{count:s.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]})]}),e.jsx(ve,{open:m.value,onClose:m.onFalse,title:"Delete",content:"Are you sure you want to delete?",action:e.jsx(R,{variant:"contained",color:"error",onClick:()=>{Y(),m.onFalse()},children:"Delete"})}),e.jsx(Ae,{dialogOpen:C,setDialogOpen:n,editId:p,fetchAllOrdersDemo:h}),e.jsx(De,{editDialogOpen:g,setEditDialogOpen:i,editData:p,dataFiltered:s,fetchAllOrdersDemo:h})]})}function Ue({inputData:o,comparator:h,filters:r}){const{name:u,status:b,commodity:m,order_status:t}=r,C=o.map((n,g)=>[n,g]);return C.sort((n,g)=>{const i=h(n[0],g[0]);return i!==0?i:n[1]-g[1]}),o=C.map(n=>n[0]),u&&(o=o.filter(n=>n.commodity.toLowerCase().includes(u.toLowerCase()))),b!=="all"&&(o=o.filter(n=>n.status===b)),m.length&&(o=o.filter(n=>m.includes(n.commodity))),t.length&&(o=o.filter(n=>t.includes(n.nccf_order_status))),o}d.string,d.array,d.array,d.string;d.object;function qe({vendorCode:o}){const{vendor:h}=_(),r=B(),[u,b]=c.useState({}),[m,t]=c.useState([]),[C,n]=c.useState(0);c.useEffect(()=>{h.csp_code&&(y(),i())},[C]);function g(){n(j=>j+1)}function i(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders_stats`).then(j=>{var p;b((p=j.data)==null?void 0:p.data[0])})}function y(){S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${h.csp_code}/orders`).then(j=>{var p;t((p=j.data)==null?void 0:p.data)})}return e.jsx(H,{maxWidth:r.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Total Orders",total:(u==null?void 0:u.total_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Pending",total:(u==null?void 0:u.placed_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Accepted",total:(u==null?void 0:u.accepted_orders)||"0"})}),e.jsx(w,{xs:12,md:3,children:e.jsx(P,{title:"Orders Declined",total:(u==null?void 0:u.declined_orders)||"0"})}),e.jsx(w,{xs:12,lg:12,children:e.jsx(Ne,{tableData:m,fetchAllOrdersDemo:g})})]})})}d.object,d.number,d.object,d.string,d.number;const q=400,I=72,Ie=Be(He)(({theme:o})=>({height:q,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:I,borderTop:`dashed 1px ${o.palette.divider}`,top:`calc(${q-I}px) !important`}}));function k({title:o,subheader:h,chart:r,...u}){const b=$(),{colors:m,series:t,options:C}=r,n=t.map(i=>i.value),g=Ee({chart:{sparkline:{enabled:!0}},colors:m,labels:t.map(i=>i.label),stroke:{colors:[b.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:i=>A(i),title:{formatter:i=>`${i}`}}},plotOptions:{pie:{donut:{size:"70%",labels:{value:{formatter:i=>A(i)},total:{formatter:i=>{const y=i.globals.seriesTotals.reduce((j,p)=>j+p,0);return A(y)}}}}}},...C});return e.jsxs(V,{...u,children:[e.jsx(ke,{title:o,subheader:h,sx:{mb:5}}),e.jsx(Ie,{dir:"ltr",type:"donut",series:n,options:g,width:"100%",height:280})]})}k.propTypes={chart:d.object,subheader:d.string,title:d.string};d.object,d.string,d.string;d.bool,d.string,d.func,d.func,d.string,d.object,d.string;function Ve({vendorCode:o}){_();const h=B();$(),c.useState([]);const[r,u]=c.useState([]),[b,m]=c.useState([]),[t,C]=c.useState([]);c.useEffect(()=>{n(),g()},[]),c.useEffect(()=>{const s=r==null?void 0:r.map((l,L)=>(l==null?void 0:l.category)!=="Distributor"?{label:z(l==null?void 0:l.category),value:l==null?void 0:l.count}:null).filter(l=>l!==null);C(s)},[r]);function n(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/category-stats").then(s=>{u(s.data.data)})}function g(){S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/csp/orders/stats").then(s=>{m(s.data.data)})}const i=["placed","accepted","declined"],y=["primary","info","warning","error"],j=["secondary","brown1","brown","brown"],p=b.filter(s=>i.includes(s.nccf_order_status)),f=[];return p.map(s=>f.push({label:N(s==null?void 0:s.nccf_order_status),value:(s==null?void 0:s["COUNT(id)"])||0})),e.jsx(H,{maxWidth:h.themeStretch?!1:"xl",children:e.jsxs(w,{container:!0,spacing:3,children:[r&&r.map((s,l)=>e.jsx(w,{xs:12,md:3,children:e.jsx(U,{title:z(s==null?void 0:s.category),total:(s==null?void 0:s.count)||0,color:y[l]})})),b&&p.map((s,l)=>e.jsx(w,{xs:12,md:4,children:e.jsx(U,{title:N(s==null?void 0:s.nccf_order_status),total:(s==null?void 0:s["COUNT(id)"])||0,color:j[l],chart:{}})})),e.jsx(w,{xs:12,md:6,lg:4,children:t!==[]&&e.jsx(k,{title:"CSP distribution",chart:{colors:["#5DD095","#0D7566","#004B50","#C8FAD6"],series:t}})}),e.jsx(w,{xs:12,md:6,lg:4,children:t!==[]&&e.jsx(k,{title:"Total Orders",chart:{colors:["#6F4E37","#A67B5B","#FED8B1","#ECB176"],series:f}})})]})})}function Ge(){const{vendor:o}=_(),h=localStorage.getItem("login_type");return e.jsxs(e.Fragment,{children:[e.jsx(Le,{children:e.jsx("title",{children:" NCCF CSP Portal "})}),h==="other-login"?e.jsx(qe,{}):(o==null?void 0:o.category)==="branch"?e.jsx(We,{}):e.jsx(Ve,{})]})}export{Ge as default};
