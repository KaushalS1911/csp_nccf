import{cn as me,c as xe,a as ge,aF as be,u as ue,r as l,d_ as $,K as S,aJ as pe,j as e,C as je,ah as G,d5 as Ce,d4 as _e,cu as ye,p as U,d$ as Ie,q as we,e0 as Se,a4 as ve,e1 as De,aA as V,dJ as Ae,dK as Be,E as re,cG as oe,cH as ie,cI as de,cd as he,e2 as He,S as Re,D as T,i as ke,dO as Oe,dQ as Fe,e3 as ze,e4 as Pe,aV as q,d0 as Te,e5 as Y,cP as Ee,e6 as Ne,bN as W,e7 as We,e8 as $e,e9 as Ge,ea as Ue,eb as Ve,H as qe}from"./index-Dq0zltwJ.js";const ne={publish:[],stock:[],commodity:[],status:"all",branch:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null,category:[]},Ye={category:!1},Qe=["category","actions"];function Je({singleCode:s}){const{enqueueSnackbar:m}=me(),x=xe(),R=ge(),C=be(),{vendor:i}=ue(),[h,o]=l.useState([]),[d,f]=l.useState(ne),[g,v]=l.useState([]),[b,_]=l.useState(!1),[p,n]=l.useState({}),[N,fe]=l.useState(!1),[Q,J]=l.useState(Ye),[K,y]=l.useState([]),[k,X]=l.useState([]),[L,D]=l.useState([]),E=$(d.startDate,d.endDate),Z=$(d.startDay,d.endDay),M=a=>{const r=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${a}/orders`;S.get(r).then(u=>{var F;return o((F=u==null?void 0:u.data)==null?void 0:F.data)}).catch(u=>console.log(u))};l.useEffect(()=>{i&&(S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080//nccf/branch/${i==null?void 0:i.branch}/csp/list`).then(a=>{var F;const r=((F=a==null?void 0:a.data)==null?void 0:F.data)||[],u=[{name:"All",csp_code:"All"},...r];y(u)}).catch(a=>console.log(a)),S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${i==null?void 0:i.branch}/order`).then(a=>{var r;return o((r=a==null?void 0:a.data)==null?void 0:r.data)}).catch(a=>console.log(a)))},[]),l.useEffect(()=>{if(k==="All"){const a=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${i==null?void 0:i.branch}/order`;S.get(a).then(r=>{var u;return o((u=r==null?void 0:r.data)==null?void 0:u.data)}).catch(r=>console.log(r))}else M(k)},[k]);const w=Ke({inputData:h,filters:d,dateError:E}),ee=l.useCallback(a=>{D(a.target.value),X(a.target.value)},[k]),I=!pe(ne,d)||!!d.startDate&&!!d.endDate||!!d.startDay&&!!d.endDay,A=l.useCallback((a,r)=>{f(u=>({...u,[a]:r}))},[]),B=l.useCallback(()=>{f(ne)},[]);l.useCallback(a=>{const r=h.filter(u=>u.id!==a);m("Delete success!"),o(r)},[m,h]);const H=[{label:"accepted",count:0},{label:"declined",count:0},{label:"placed",count:0}],te=["primary","error","warning","error"];H.forEach(a=>{a.count=w.filter(r=>r.nccf_order_status===a.label).length});const ae=[{value:"all",label:"All"},{value:"Bharat Aata",label:"Bharat Aata"},{value:"Bharat Daal",label:"Bharat Daal"},{value:"Bharat Rice",label:"Bharat Rice"}],se=l.useCallback(()=>{const a=h.filter(r=>!g.includes(r.id));m("Delete success!"),o(a)},[m,g,h]);l.useCallback(a=>{},[R]);const O=[{field:"seq_number",headerName:"SR No.",minWidth:200,renderCell:a=>e.jsx(Ee,{children:a.row.seq_number})},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:a=>Ne(a.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:a=>e.jsx(W,{children:e.jsx(V,{variant:"soft",color:a.row.nccf_order_status==="accepted"&&"success"||a.row.nccf_order_status==="placed"&&"warning"||a.row.nccf_order_status==="declined"&&"error"||"default",children:a.row.nccf_order_status==="accepted"?"Accepted":a.row.nccf_order_status==="declined"?"Declined":"Placed"})})}],le=l.useCallback((a,r)=>{A("status",r)},[A]),z=()=>O.filter(a=>!Qe.includes(a.field)).map(a=>a.field);return e.jsxs(e.Fragment,{children:[e.jsxs(je,{maxWidth:C.themeStretch?!1:"xl",children:[e.jsx(G,{container:!0,spacing:3,children:H.map((a,r)=>e.jsx(G,{item:!0,xs:12,md:4,mb:5,children:e.jsx(Ce,{title:_e(a==null?void 0:a.label),total:(a==null?void 0:a.count)==0?"0":a.count,color:te[r],chart:{}})}))}),e.jsx(ye,{heading:"Order List",links:[{name:"Dashboard",href:U.dashboard.root},{name:"Order",href:U.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),e.jsx(Ie,{getAllDocument:M,currentUser:p,open:b,setOpen:_,approve:N,cspCode:L}),e.jsxs(we,{sx:{height:(w==null?void 0:w.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[e.jsx(Se,{value:d.status,onChange:le,sx:{px:2.5,boxShadow:a=>`inset 0 -2px 0 0 ${ve(a.palette.grey[500],.08)}`},children:ae.map(a=>e.jsx(De,{iconPosition:"end",value:a.value,label:a.label,icon:e.jsx(V,{variant:(a.value==="all"||a.value===d.status)&&"filled"||"soft",color:a.value==="Bharat Aata"&&"success"||a.value==="Bharat Daal"&&"warning"||a.value==="Bharat Rice"&&"error"||"default",children:["Bharat Aata","Bharat Rice","Bharat Daal"].includes(a.value)?h.filter(r=>r.commodity===a.value).length:h.length})},a.value))}),e.jsx(Ae,{disableRowSelectionOnClick:!0,rows:w,columns:O,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:Q,onColumnVisibilityModelChange:a=>J(a),slots:{toolbar:()=>e.jsx(e.Fragment,{children:e.jsxs(Be,{children:[e.jsxs(re,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(oe,{children:"CSP"}),e.jsx(ie,{value:k,onChange:ee,input:e.jsx(de,{label:"Type"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:K.map(a=>e.jsx(he,{value:a.csp_code,disabled:a.order_count===0,children:a.name},a.csp_code))})]}),I&&e.jsx(He,{filters:d,onFilters:A,onResetFilters:B,results:w.length,sx:{p:2.5,pt:0}}),e.jsxs(Re,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!g.length&&e.jsxs(T,{size:"small",color:"error",startIcon:e.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:x.onTrue,children:["Delete (",g.length,")"]}),e.jsx(Oe,{}),e.jsx(Fe,{})]}),e.jsx(ze,{filters:d,onFilters:A,roleOptions:Pe,branchOptions:["hello"],dateError:E,dayError:Z})]})}),noRowsOverlay:()=>e.jsx(q,{title:"No Data"}),noResultsOverlay:()=>e.jsx(q,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:z}}})]})]}),e.jsx(Te,{open:x.value,onClose:x.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",g.length," "]})," items?"]}),action:e.jsx(T,{variant:"contained",color:"error",onClick:()=>{se(),x.onFalse()},children:"Delete"})})]})}function Ke({inputData:s,filters:m,dateError:x,dayError:R}){const{stock:C,publish:i,status:h,commodity:o,name:d,branch:f,startDate:g,endDate:v,startDay:b,endDay:_,category:p}=m;return C.length&&(s=s.filter(n=>C.includes(n.inventoryType))),x||g&&v&&(s=s.filter(n=>Y(n.created_at,g,v))),R||b&&_&&(s=s.filter(n=>Y(n.created_at,b,_))),i.length&&(s=s.filter(n=>i.includes(n.publish))),d&&(s=s.filter(n=>n.name.toLowerCase().indexOf(d.toLowerCase())!==-1)),h!=="all"&&(s=s.filter(n=>n.commodity===h)),o.length&&(s=s.filter(n=>o.includes(n.nccf_order_status))),p.length&&(s=s.filter(n=>p.includes(n.category))),f.length&&(s=s.filter(n=>f.includes(n.branch))),s}const ce={publish:[],stock:[],commodity:[],status:"all",branch:[],category:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null},Xe={category:!1},Ze=["category","actions"];function et({singleCode:s}){const{enqueueSnackbar:m}=me(),x=xe(),R=ge(),C=be();ue();const[i,h]=l.useState([]),[o,d]=l.useState(ce),[f,g]=l.useState([]),[v,b]=l.useState(!1),[_,p]=l.useState({}),[n,N]=l.useState(!1),[fe,Q]=l.useState(Xe),[J,K]=l.useState([]),[y,k]=l.useState("All"),[X,L]=l.useState([]),[D,E]=l.useState("All"),[Z,M]=l.useState([]),w=$(o.startDate,o.endDate),ee=$(o.startDay,o.endDay);l.useState([]);const I=()=>{const t=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${y}/order`;S.get(t).then(c=>{var j;return h((j=c==null?void 0:c.data)==null?void 0:j.data)}).catch(c=>console.log(c))};l.useEffect(()=>{y==="All"?A():(H(),I())},[y]);const A=()=>{S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/order").then(t=>{var c;return h((c=t==null?void 0:t.data)==null?void 0:c.data)}).catch(t=>console.log(t))};l.useEffect(()=>{S.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/state/branch").then(t=>{var P;const c=((P=t==null?void 0:t.data)==null?void 0:P.data)||[],j=[{branch_name:"All",csp_count:1},...c];K(j)}).catch(t=>console.log(t)),A()},[]);const B=tt({inputData:i,filters:o,dateError:w}),H=async()=>{if(y!=="All"){L([]);try{let c=(await S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${y}/csp`)).data.data.map(P=>({name:P.name,csp_code:P.csp_code,order_count:P.order_count}));const j=[{name:"All",csp_code:"All",order_count:1},...c];L(j)}catch(t){console.error("Error fetching data:",t)}}};l.useEffect(()=>{D==="All"?I():S.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${D}/orders`).then(t=>{var c;return h((c=t==null?void 0:t.data)==null?void 0:c.data)}).catch(t=>console.log(t))},[D]);const te=l.useCallback(t=>{M(t.target.value),E(t.target.value)},[D]),ae=l.useCallback(t=>{k(t.target.value),E("All")},[D]),se=!pe(ce,o)||!!o.startDate&&!!o.endDate||!!o.startDay&&!!o.endDay,O=l.useCallback((t,c)=>{d(j=>({...j,[t]:c}))},[]),le=l.useCallback(()=>{d(ce)},[]);l.useCallback(t=>{const c=i.filter(j=>j.id!==t);m("Delete success!"),h(c)},[m,i]);const z=[{label:"accepted",count:0},{label:"declined",count:0},{label:"placed",count:0}];z.forEach(t=>{t.count=B.filter(c=>c.nccf_order_status===t.label).length});const a=[{value:"all",label:"All"},{value:"Bharat Aata",label:"Bharat Aata"},{value:"Bharat Daal",label:"Bharat Daal"},{value:"Bharat Rice",label:"Bharat Rice"}],r=l.useCallback(()=>{const t=i.filter(c=>!f.includes(c.id));m("Delete success!"),h(t)},[m,f,i]);l.useCallback(t=>{},[R]);const u=[{field:"id",headerName:"#",minWidth:100,renderCell:t=>e.jsx(Ee,{children:t.row.id})},{field:"name",headerName:"Name",width:250},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"branch",headerName:"Branch",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:t=>Ne(t.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:t=>e.jsx(W,{children:e.jsx(V,{variant:"soft",color:t.row.nccf_order_status==="accepted"&&"success"||t.row.nccf_order_status==="placed"&&"warning"||t.row.nccf_order_status==="declined"&&"error"||"default",children:t.row.nccf_order_status==="accepted"?"Accepted":t.row.nccf_order_status==="declined"?"Declined":"Placed"})})},{field:"vendor1",headerName:"Action",flex:.5,minWidth:250,renderCell:t=>e.jsxs(e.Fragment,{children:[e.jsx(W,{sx:{px:0,marginRight:2},children:e.jsxs(T,{disabled:t.row.nccf_order_status==="accepted"||t.row.nccf_order_status==="declined",variant:"contained",onClick:()=>{p(t.row),N(!0),b(!0)},sx:{backgroundColor:"green",width:90},children:[e.jsx(Ue,{})," Approve"]})}),e.jsx(W,{sx:{px:0},children:e.jsxs(T,{disabled:t.row.nccf_order_status==="accepted"||t.row.nccf_order_status==="declined",onClick:()=>{p(t.row),N(!1),b(!0)},variant:"contained",sx:{backgroundColor:"red",width:80},children:[e.jsx(Ve,{})," Reject"]})})]})}],F=["primary","error","warning","error"],Le=l.useCallback((t,c)=>{O("status",c)},[O]),Me=()=>u.filter(t=>!Ze.includes(t.field)).map(t=>t.field);return e.jsxs(e.Fragment,{children:[e.jsxs(je,{maxWidth:C.themeStretch?!1:"xl",children:[e.jsx(G,{container:!0,spacing:3,children:z.map((t,c)=>e.jsx(G,{item:!0,xs:12,md:4,mb:5,children:e.jsx(Ce,{title:_e(t==null?void 0:t.label),total:(t==null?void 0:t.count)==0?"0":t.count,color:F[c],chart:{}})}))}),e.jsx(ye,{heading:"Order List",links:[{name:"Dashboard",href:U.dashboard.root},{name:"Order",href:U.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),e.jsx(We,{getAllDocument:A,currentUser:_,open:v,setOpen:b,approve:n,cspCode:Z}),e.jsxs(we,{sx:{height:(B==null?void 0:B.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[e.jsx(Se,{value:o.status,onChange:Le,sx:{px:2.5,boxShadow:t=>`inset 0 -2px 0 0 ${ve(t.palette.grey[500],.08)}`},children:a.map(t=>e.jsx(De,{iconPosition:"end",value:t.value,label:t.label,icon:e.jsx(V,{variant:(t.value==="all"||t.value===o.status)&&"filled"||"soft",color:t.value==="Bharat Aata"&&"success"||t.value==="Bharat Daal"&&"warning"||t.value==="Bharat Rice"&&"error"||"default",children:["Bharat Aata","Bharat Rice","Bharat Daal"].includes(t.value)?i.filter(c=>c.commodity===t.value).length:i.length})},t.value))}),e.jsx(Ae,{disableRowSelectionOnClick:!0,rows:B,columns:u,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:fe,onColumnVisibilityModelChange:t=>Q(t),slots:{toolbar:()=>e.jsx(e.Fragment,{children:e.jsxs(Be,{children:[e.jsxs(re,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(oe,{children:"Branch"}),e.jsx(ie,{value:y,onChange:ae,input:e.jsx(de,{label:"Branch"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:J.map(t=>e.jsx(he,{value:t.branch_name,disabled:t.csp_count==0,children:t.branch_name},t.branch_name))})]}),y!=="All"&&e.jsxs(re,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(oe,{children:"CSP"}),e.jsx(ie,{value:D,onChange:te,input:e.jsx(de,{label:"CSP"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:X.map(t=>e.jsx(he,{value:t.csp_code,disabled:t.order_count==0,children:t.name},t.csp_code))})]}),se&&e.jsx($e,{filters:o,onFilters:O,onResetFilters:le,results:B.length,sx:{p:2.5,pt:0}}),e.jsxs(Re,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!f.length&&e.jsxs(T,{size:"small",color:"error",startIcon:e.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:x.onTrue,children:["Delete (",f.length,")"]}),e.jsx(Oe,{}),e.jsx(Fe,{})]}),e.jsx(Ge,{filters:o,onFilters:O,roleOptions:Pe,branchOptions:["hello"],dateError:w,dayError:ee})]})}),noRowsOverlay:()=>e.jsx(q,{title:"No Data"}),noResultsOverlay:()=>e.jsx(q,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:Me}}})]})]}),e.jsx(Te,{open:x.value,onClose:x.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",f.length," "]})," items?"]}),action:e.jsx(T,{variant:"contained",color:"error",onClick:()=>{r(),x.onFalse()},children:"Delete"})})]})}function tt({inputData:s,filters:m,dateError:x,dayError:R}){const{stock:C,publish:i,status:h,commodity:o,name:d,branch:f,startDate:g,endDate:v,startDay:b,endDay:_,category:p}=m;return C.length&&(s=s.filter(n=>C.includes(n.inventoryType))),x||g&&v&&(s=s.filter(n=>Y(n.created_at,g,v))),R||b&&_&&(s=s.filter(n=>Y(n.created_at,b,_))),i.length&&(s=s.filter(n=>i.includes(n.publish))),d&&(s=s.filter(n=>n.name.toLowerCase().indexOf(d.toLowerCase())!==-1)),p.length&&(s=s.filter(n=>p.includes(n.category))),h!=="all"&&(s=s.filter(n=>n.commodity===h)),o.length&&(s=s.filter(n=>o.includes(n.nccf_order_status))),f.length&&(s=s.filter(n=>f.includes(n.branch))),s}function st(){const{vendor:s}=ue();return e.jsxs(e.Fragment,{children:[e.jsx(qe,{children:e.jsx("title",{children:" Dashboard: Order List"})}),(s==null?void 0:s.category)==="branch"?e.jsx(Je,{}):e.jsx(et,{})]})}export{st as default};
