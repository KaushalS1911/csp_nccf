import{cn as fe,c as me,a as xe,aF as ge,u as re,r as s,dZ as z,K as w,aJ as be,j as t,C as pe,cu as je,p as W,d_ as Le,q as Ce,d$ as _e,a4 as we,e0 as ye,aA as $,dI as Se,dJ as ve,E as se,cG as le,cH as ne,cI as ce,cd as oe,e1 as Ie,S as De,D as P,i as ke,dN as Ae,dP as Oe,e2 as Me,e3 as Re,aV as G,d0 as Fe,e4 as U,cP as Be,e5 as Pe,bN as H,ah as he,d8 as He,d7 as ze,e6 as We,e7 as $e,e8 as Ge,e9 as Ue,ea as Ve,H as Ye}from"./index-l7BS0nIA.js";const te={publish:[],stock:[],commodity:[],status:"all",branch:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null},qe={category:!1},Qe=["category","actions"];function Je({singleCode:l}){const{enqueueSnackbar:m}=fe(),x=me(),A=xe(),j=ge(),{vendor:i}=re(),[u,o]=s.useState([]),[d,f]=s.useState(te),[g,y]=s.useState([]),[b,C]=s.useState(!1),[n,ie]=s.useState({}),[N,de]=s.useState(!1),[V,Y]=s.useState(qe),[q,_]=s.useState([]),[O,Q]=s.useState([]),[E,S]=s.useState([]),T=z(d.startDate,d.endDate),J=z(d.startDay,d.endDay),L=a=>{const r=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${a}/orders`;w.get(r).then(h=>{var R;return o((R=h==null?void 0:h.data)==null?void 0:R.data)}).catch(h=>console.log(h))};s.useEffect(()=>{i&&(w.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080//nccf/branch/${i==null?void 0:i.branch}/csp/list`).then(a=>{var R;const r=((R=a==null?void 0:a.data)==null?void 0:R.data)||[],h=[{name:"All",csp_code:"All"},...r];_(h)}).catch(a=>console.log(a)),w.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${i==null?void 0:i.branch}/order`).then(a=>{var r;return o((r=a==null?void 0:a.data)==null?void 0:r.data)}).catch(a=>console.log(a)))},[]),s.useEffect(()=>{if(O==="All"){const a=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${i==null?void 0:i.branch}/order`;w.get(a).then(r=>{var h;return o((h=r==null?void 0:r.data)==null?void 0:h.data)}).catch(r=>console.log(r))}else L(O)},[O]);const v=Ke({inputData:u,filters:d,dateError:T}),K=s.useCallback(a=>{S(a.target.value),Q(a.target.value)},[O]),I=!be(te,d)||!!d.startDate&&!!d.endDate||!!d.startDay&&!!d.endDay,D=s.useCallback((a,r)=>{f(h=>({...h,[a]:r}))},[]),k=s.useCallback(()=>{f(te)},[]);s.useCallback(a=>{const r=u.filter(h=>h.id!==a);m("Delete success!"),o(r)},[m,u]);const Z=[{value:"all",label:"All"},{value:"1",label:"Accepted"},{value:"placed",label:"Placed"},{value:"0",label:"Declined"}],X=s.useCallback(()=>{const a=u.filter(r=>!g.includes(r.id));m("Delete success!"),o(a)},[m,g,u]);s.useCallback(a=>{},[A]);const M=[{field:"id",headerName:"#",minWidth:200,renderCell:a=>t.jsx(Be,{children:a.row.id})},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:a=>Pe(a.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:a=>t.jsx(H,{children:t.jsx($,{variant:"soft",color:a.row.nccf_order_status==="1"&&"success"||a.row.nccf_order_status==="placed"&&"warning"||a.row.nccf_order_status==="0"&&"error"||"default",children:a.row.nccf_order_status==="1"?"Approved":a.row.nccf_order_status==="0"?"Rejected":"Placed"})})}],ee=s.useCallback((a,r)=>{D("status",r)},[D]),F=()=>M.filter(a=>!Qe.includes(a.field)).map(a=>a.field);return t.jsxs(t.Fragment,{children:[t.jsxs(pe,{maxWidth:j.themeStretch?!1:"xl",children:[t.jsx(je,{heading:"Order List",links:[{name:"Dashboard",href:W.dashboard.root},{name:"Order",href:W.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),t.jsx(Le,{getAllDocument:L,currentUser:n,open:b,setOpen:C,approve:N,cspCode:E}),t.jsxs(Ce,{sx:{height:(v==null?void 0:v.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[t.jsx(_e,{value:d.status,onChange:ee,sx:{px:2.5,boxShadow:a=>`inset 0 -2px 0 0 ${we(a.palette.grey[500],.08)}`},children:Z.map(a=>t.jsx(ye,{iconPosition:"end",value:a.value,label:a.label,icon:t.jsx($,{variant:(a.value==="all"||a.value===d.status)&&"filled"||"soft",color:a.value==="1"&&"success"||a.value==="placed"&&"warning"||a.value==="0"&&"error"||"default",children:["1","0","placed"].includes(a.value)?u.filter(r=>r.nccf_order_status===a.value).length:u.length})},a.value))}),t.jsx(Se,{disableRowSelectionOnClick:!0,rows:v,columns:M,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:V,onColumnVisibilityModelChange:a=>Y(a),slots:{toolbar:()=>t.jsx(t.Fragment,{children:t.jsxs(ve,{children:[t.jsxs(se,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[t.jsx(le,{children:"CSP"}),t.jsx(ne,{value:O,onChange:K,input:t.jsx(ce,{label:"Type"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:q.map(a=>t.jsx(oe,{value:a.csp_code,disabled:a.order_count===0,children:a.name},a.csp_code))})]}),I&&t.jsx(Ie,{filters:d,onFilters:D,onResetFilters:k,results:v.length,sx:{p:2.5,pt:0}}),t.jsxs(De,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!g.length&&t.jsxs(P,{size:"small",color:"error",startIcon:t.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:x.onTrue,children:["Delete (",g.length,")"]}),t.jsx(Ae,{}),t.jsx(Oe,{})]}),t.jsx(Me,{filters:d,onFilters:D,roleOptions:Re,branchOptions:["hello"],dateError:T,dayError:J})]})}),noRowsOverlay:()=>t.jsx(G,{title:"No Data"}),noResultsOverlay:()=>t.jsx(G,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:F}}})]})]}),t.jsx(Fe,{open:x.value,onClose:x.onFalse,title:"Delete",content:t.jsxs(t.Fragment,{children:["Are you sure want to delete ",t.jsxs("strong",{children:[" ",g.length," "]})," items?"]}),action:t.jsx(P,{variant:"contained",color:"error",onClick:()=>{X(),x.onFalse()},children:"Delete"})})]})}function Ke({inputData:l,filters:m,dateError:x,dayError:A}){const{stock:j,publish:i,status:u,commodity:o,name:d,branch:f,startDate:g,endDate:y,startDay:b,endDay:C}=m;return j.length&&(l=l.filter(n=>j.includes(n.inventoryType))),x||g&&y&&(l=l.filter(n=>U(n.created_at,g,y))),A||b&&C&&(l=l.filter(n=>U(n.created_at,b,C))),i.length&&(l=l.filter(n=>i.includes(n.publish))),d&&(l=l.filter(n=>n.name.toLowerCase().indexOf(d.toLowerCase())!==-1)),u!=="all"&&(l=l.filter(n=>n.nccf_order_status===u)),o.length&&(l=l.filter(n=>o.includes(n.commodity))),f.length&&(l=l.filter(n=>f.includes(n.branch))),l}const ae={publish:[],stock:[],commodity:[],status:"all",branch:[],name:"",startDate:null,endDate:null,startDay:null,endDay:null},Ze={category:!1},Xe=["category","actions"];function et({singleCode:l}){const{enqueueSnackbar:m}=fe(),x=me(),A=xe(),j=ge();re();const[i,u]=s.useState([]),[o,d]=s.useState(ae),[f,g]=s.useState([]),[y,b]=s.useState(!1),[C,n]=s.useState({}),[ie,N]=s.useState(!1),[de,V]=s.useState(Ze),[Y,q]=s.useState([]),[_,O]=s.useState("All"),[Q,E]=s.useState([]),[S,T]=s.useState("All"),[J,L]=s.useState([]),v=z(o.startDate,o.endDate),K=z(o.startDay,o.endDay);s.useState([]);const I=()=>{const e=`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${_}/order`;w.get(e).then(c=>{var p;return u((p=c==null?void 0:c.data)==null?void 0:p.data)}).catch(c=>console.log(c))};s.useEffect(()=>{_==="All"?D():(Z(),I())},[_]);const D=()=>{w.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/ho/order").then(e=>{var c;return u((c=e==null?void 0:e.data)==null?void 0:c.data)}).catch(e=>console.log(e))};s.useEffect(()=>{w.get("http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/state/branch").then(e=>{var B;const c=((B=e==null?void 0:e.data)==null?void 0:B.data)||[],p=[{branch_name:"All",csp_count:1},...c];q(p)}).catch(e=>console.log(e)),D()},[]);const k=tt({inputData:i,filters:o,dateError:v}),Z=async()=>{if(_!=="All"){E([]);try{let c=(await w.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/branch/${_}/csp`)).data.data.map(B=>({name:B.name,csp_code:B.csp_code,order_count:B.order_count}));const p=[{name:"All",csp_code:"All",order_count:1},...c];E(p)}catch(e){console.error("Error fetching data:",e)}}};s.useEffect(()=>{S==="All"?I():w.get(`http://ec2-54-173-125-80.compute-1.amazonaws.com:8080/nccf/csp/${S}/orders`).then(e=>{var c;return u((c=e==null?void 0:e.data)==null?void 0:c.data)}).catch(e=>console.log(e))},[S]);const X=s.useCallback(e=>{L(e.target.value),T(e.target.value)},[S]),M=s.useCallback(e=>{O(e.target.value),T("All")},[S]),ee=!be(ae,o)||!!o.startDate&&!!o.endDate||!!o.startDay&&!!o.endDay,F=s.useCallback((e,c)=>{d(p=>({...p,[e]:c}))},[]),a=s.useCallback(()=>{d(ae)},[]);s.useCallback(e=>{const c=i.filter(p=>p.id!==e);m("Delete success!"),u(c)},[m,i]);const r=[{label:"accepted",count:0},{label:"declined",count:0},{label:"placed",count:0}];r.forEach(e=>{e.count=k.filter(c=>c.nccf_order_status===e.label).length});const h=[{value:"all",label:"All"},{value:"Bharat Aata",label:"Bharat Aata"},{value:"Bharat Daal",label:"Bharat Daal"},{value:"Bharat Rice",label:"Bharat Rice"}],R=s.useCallback(()=>{const e=i.filter(c=>!f.includes(c.id));m("Delete success!"),u(e)},[m,f,i]);s.useCallback(e=>{},[A]);const ue=[{field:"id",headerName:"#",minWidth:100,renderCell:e=>t.jsx(Be,{children:e.row.id})},{field:"name",headerName:"Name",width:250},{field:"commodity",headerName:"Commodity",minWidth:150,flex:1},{field:"quantity",headerName:"Quantity",minWidth:100,flex:1},{field:"branch",headerName:"Branch",minWidth:100,flex:1},{field:"created_at",headerName:"Date",minWidth:150,flex:1,renderCell:e=>Pe(e.row.created_at).format("DD/MM/YYYY")},{field:"nccf_order_status",headerName:"Order Status",minWidth:100,flex:1,renderCell:e=>t.jsx(H,{children:t.jsx($,{variant:"soft",color:e.row.nccf_order_status==="accepted"&&"success"||e.row.nccf_order_status==="placed"&&"warning"||e.row.nccf_order_status==="declined"&&"error"||"default",children:e.row.nccf_order_status==="accepted"?"Accepted":e.row.nccf_order_status==="declined"?"Declined":"Placed"})})},{field:"vendor1",headerName:"Action",flex:.5,minWidth:250,renderCell:e=>t.jsxs(t.Fragment,{children:[t.jsx(H,{sx:{px:0,marginRight:2},children:t.jsxs(P,{disabled:e.row.nccf_order_status==="accepted"||e.row.nccf_order_status==="declined",variant:"contained",onClick:()=>{n(e.row),N(!0),b(!0)},sx:{backgroundColor:"green",width:90},children:[t.jsx(Ue,{})," Approve"]})}),t.jsx(H,{sx:{px:0},children:t.jsxs(P,{disabled:e.row.nccf_order_status==="accepted"||e.row.nccf_order_status==="declined",onClick:()=>{n(e.row),N(!1),b(!0)},variant:"contained",sx:{backgroundColor:"red",width:80},children:[t.jsx(Ve,{})," Reject"]})})]})}],Te=["primary","error","warning","error"],Ne=s.useCallback((e,c)=>{F("status",c)},[F]),Ee=()=>ue.filter(e=>!Xe.includes(e.field)).map(e=>e.field);return t.jsxs(t.Fragment,{children:[t.jsxs(pe,{maxWidth:j.themeStretch?!1:"xl",children:[t.jsx(he,{container:!0,spacing:3,children:r.map((e,c)=>t.jsx(he,{item:!0,xs:12,md:4,mb:5,children:t.jsx(He,{title:ze(e==null?void 0:e.label),total:(e==null?void 0:e.count)==0?"0":e.count,color:Te[c],chart:{}})}))}),t.jsx(je,{heading:"Order List",links:[{name:"Dashboard",href:W.dashboard.root},{name:"Order",href:W.dashboard.orders},{name:"List"}],sx:{mb:{xs:3,md:5}}}),t.jsx(We,{getAllDocument:D,currentUser:C,open:y,setOpen:b,approve:ie,cspCode:J}),t.jsxs(Ce,{sx:{height:(k==null?void 0:k.length)>0?"unset":700,flexGrow:{md:1},display:{md:"flex"},flexDirection:{md:"column"}},children:[t.jsx(_e,{value:o.status,onChange:Ne,sx:{px:2.5,boxShadow:e=>`inset 0 -2px 0 0 ${we(e.palette.grey[500],.08)}`},children:h.map(e=>t.jsx(ye,{iconPosition:"end",value:e.value,label:e.label,icon:t.jsx($,{variant:(e.value==="all"||e.value===o.status)&&"filled"||"soft",color:e.value==="Bharat Aata"&&"success"||e.value==="Bharat Daal"&&"warning"||e.value==="Bharat Rice"&&"error"||"default",children:["Bharat Aata","Bharat Rice","Bharat Daal"].includes(e.value)?i.filter(c=>c.commodity===e.value).length:i.length})},e.value))}),t.jsx(Se,{disableRowSelectionOnClick:!0,rows:k,columns:ue,getRowHeight:()=>"auto",pageSizeOptions:[5,10,25],initialState:{pagination:{paginationModel:{pageSize:5}}},columnVisibilityModel:de,onColumnVisibilityModelChange:e=>V(e),slots:{toolbar:()=>t.jsx(t.Fragment,{children:t.jsxs(ve,{children:[t.jsxs(se,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[t.jsx(le,{children:"Branch"}),t.jsx(ne,{value:_,onChange:M,input:t.jsx(ce,{label:"Branch"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:Y.map(e=>t.jsx(oe,{value:e.branch_name,disabled:e.csp_count==0,children:e.branch_name},e.branch_name))})]}),_!=="All"&&t.jsxs(se,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[t.jsx(le,{children:"CSP"}),t.jsx(ne,{value:S,onChange:X,input:t.jsx(ce,{label:"CSP"}),MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:Q.map(e=>t.jsx(oe,{value:e.csp_code,disabled:e.order_count==0,children:e.name},e.csp_code))})]}),ee&&t.jsx($e,{filters:o,onFilters:F,onResetFilters:a,results:k.length,sx:{p:2.5,pt:0}}),t.jsxs(De,{spacing:1,flexGrow:1,direction:"row",alignItems:"center",justifyContent:"flex-end",children:[!!f.length&&t.jsxs(P,{size:"small",color:"error",startIcon:t.jsx(ke,{icon:"solar:trash-bin-trash-bold"}),onClick:x.onTrue,children:["Delete (",f.length,")"]}),t.jsx(Ae,{}),t.jsx(Oe,{})]}),t.jsx(Ge,{filters:o,onFilters:F,roleOptions:Re,branchOptions:["hello"],dateError:v,dayError:K})]})}),noRowsOverlay:()=>t.jsx(G,{title:"No Data"}),noResultsOverlay:()=>t.jsx(G,{title:"No results found"})},slotProps:{columnsPanel:{getTogglableColumns:Ee}}})]})]}),t.jsx(Fe,{open:x.value,onClose:x.onFalse,title:"Delete",content:t.jsxs(t.Fragment,{children:["Are you sure want to delete ",t.jsxs("strong",{children:[" ",f.length," "]})," items?"]}),action:t.jsx(P,{variant:"contained",color:"error",onClick:()=>{R(),x.onFalse()},children:"Delete"})})]})}function tt({inputData:l,filters:m,dateError:x,dayError:A}){const{stock:j,publish:i,status:u,commodity:o,name:d,branch:f,startDate:g,endDate:y,startDay:b,endDay:C}=m;return j.length&&(l=l.filter(n=>j.includes(n.inventoryType))),x||g&&y&&(l=l.filter(n=>U(n.created_at,g,y))),A||b&&C&&(l=l.filter(n=>U(n.created_at,b,C))),i.length&&(l=l.filter(n=>i.includes(n.publish))),d&&(l=l.filter(n=>n.name.toLowerCase().indexOf(d.toLowerCase())!==-1)),u!=="all"&&(l=l.filter(n=>n.commodity===u)),o.length&&(l=l.filter(n=>o.includes(n.commodity))),f.length&&(l=l.filter(n=>f.includes(n.branch))),l}function st(){const{vendor:l}=re();return t.jsxs(t.Fragment,{children:[t.jsx(Ye,{children:t.jsx("title",{children:" Dashboard: Order List"})}),(l==null?void 0:l.category)==="branch"?t.jsx(Je,{}):t.jsx(et,{})]})}export{st as default};
